## üìî–û—Å–Ω–æ–≤—ã

#priority/üî•high #üìëtheory/üß†sql 

### üìë–ö–∞–∫–∏–µ –≤–∏–¥—ã –¥–∂–æ–∏–Ω–æ–≤ –∑–Ω–∞–µ—à—å, —á–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è?

![[Pasted image 20250423120454.png]]

![[Pasted image 20250423120541.png]]

### üìë–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è HAVING –æ—Ç WHERE?

`WHERE` —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ –¥–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏, –∞ `HAVING` - –ø–æ—Å–ª–µ; —á–∞—Å—Ç–æ –≤ `HAVING` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: `SUM(), MIN(), MAX(), AVG(), COUNT()`

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∏–≥–≥–µ—Ä?

–û–±—ä–µ–∫—Ç –≤ –ë–î, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∫–∞–∫–æ–µ-–ª–∏–±–æ –∏–∑ –¥–µ–π—Å—Ç–≤–∏–π: **–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏–ª–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö. –ü–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã, —Ç—Ä–∏–≥–≥–µ—Ä—ã –±—ã–≤–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏—Ö —Ç–∏–ø–æ–≤:
	- `before`: —Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–î–û** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è
	- `after`: —Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–ü–û–°–õ–ï** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è
	- `instead of`: —Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–í–ú–ï–°–¢–û** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è (–æ–±—ã—á–Ω–æ —Ç–∞–∫–æ–µ –Ω—É–∂–Ω–æ –≤–æ `view`)

### üìë–í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É DELETE –∏ TRUNCATE?

|                              | `DELETE`                                                                         | `TRUNCATE`                                                                                                                                               |
| ---------------------------- | -------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| —á—Ç–æ –¥–µ–ª–∞–µ—Ç                   | —É–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É(-–∏)                                                               | —É–¥–∞–ª—è–µ—Ç **—Å—Ä–∞–∑—É –≤—Å–µ** —Å—Ç—Ä–æ–∫–∏ **–≤ —Ç–∞–±–ª–∏—Ü–µ**                                                                                                               |
| –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å `WHERE` | **–¥–∞**                                                                           | –Ω–µ—Ç                                                                                                                                                      |
| –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å `ROLLBACK`     | –¥–∞, —Ç.–∫. [[DELETE –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π –ª–æ–≥\|–∑–∞–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π –ª–æ–≥]] | –Ω–µ—Ç, –≤–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∏–≥–¥–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ä—É—á–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Ç.–µ. –∫–æ–≥–¥–∞ –º—ã —Ä—É–∫–∞–º–∏ –ø–∏—à–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è) |
| –±–ª–æ–∫–∏—Ä—É–µ—Ç                    | —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏                                                                    | **—Ü–µ–ª–∏–∫–æ–º –≤—Å—é —Ç–∞–±–ª–∏—Ü—É**                                                                                                                                  |
| –∫–∞–∫ –º—ç—Ç—á–∏—Ç—Å—è —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏    | —Ç—Ä–∏–≥–≥–µ—Ä—ã `ON DELETE` —Ä–∞–±–æ—Ç–∞—é—Ç                                                    | —Ç—Ä–∏–≥–≥–µ—Ä—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç                                                                                                                                  |
### üìë–°–∫–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ –∑–∞–Ω–∏–º–∞–µ—Ç int, long –∏ guid?

| `.NET` | `PostgreSQL` | —Ä–∞–∑–º–µ—Ä, –±–∞–π—Ç |
| ------ | ------------ | ------------ |
| `int`  | `integer`    | 4            |
| `long` | `bigint`     | 8            |
| `guid` | `uuid`       | 16           |

### üìë–ö–æ–≥–¥–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ PK –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å guid, –∞ –∫–æ–≥–¥–∞ long?

|              |                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                             |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| —É—Å–ª–æ–≤–∏—è      | - –µ—Å–ª–∏ –≤–∞–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ç.–∫. `long` –∑–∞–Ω–∏–º–∞–µ—Ç –≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –º–µ—Å—Ç–∞<br>- –µ—Å–ª–∏ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∏ –≤ –ë–î —Ä–∞—Å–ø–æ–ª–∞–≥–∞–ª–∏—Å—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (—ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ [[–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è long –≤ –∫–∞—á–µ—Å—Ç–≤–µ PR\|–∏–Ω–¥–µ–∫—Å–∞–º–∏]] + –≤—Å—Ç–∞–≤–∫–∞ –∑–∞–ø–∏—Å–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ) | - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ<br>- –µ—Å–ª–∏ —É –Ω–∞—Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (`guid` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ `id` –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –∏ –ø–æ—Ç–æ–º, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ, —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º–∏ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º)<br>- –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏ –≤–Ω–µ –ë–î |
| —á—Ç–æ –≤—ã–±–∏—Ä–∞–µ–º | `long`                                                                                                                                                                                                                                                                                   | `guid`                                                                                                                                                                                                                                      |

## üìî–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#priority/üî•high #üìëtheory/üß†sql 

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω–¥–µ–∫—Å?

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—Å–∫–æ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∏—Å–∫–∞, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. *–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –∏–Ω–¥–µ–∫—Å–∞* ‚Äî —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

–ï—Å–ª–∏ —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –∏–¥–µ—Ç `JOIN` —Ç–∞–±–ª–∏—Ü, —Ç–æ —Ç–∞–∫–æ–π `JOIN` –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ.

–ï—Å–ª–∏ [[–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å|–∏–Ω–¥–µ–∫—Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π]], —Ç–æ –æ–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤ —Å—Ç–æ–ª–±—Ü–µ –Ω–µ –±—É–¥–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∑–Ω–∞—á–µ–Ω–∏–π.

–ò–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è, –ù–û –∑–∞–º–µ–¥–ª—è—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ `INSERT, UPDATE, DELETE`, —Ç.–∫. –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–ª–µ—á–µ—Ç –∑–∞ —Å–æ–±–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–Ω–¥–µ–∫—Å–æ–≤. –û–±—ã—á–Ω–æ –∏–Ω–¥–µ–∫—Å—ã –ø–æ–ª–µ–∑–Ω—ã –Ω–∞ —Å—Ç–æ–ª–±—Ü–∞—Ö, –ø–æ –∫–æ—Ç–æ—Ä—ã–º —á–∞—Å—Ç–æ –∏–¥–µ—Ç –ø–æ–∏—Å–∫ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Ç.–µ. —Å—Ç–æ–ª–±–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤ `WHERE, ORDER BY, JOIN`.

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –°–£–ë–î –∏–Ω–¥–µ–∫—Å—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –Ω–∞ –¥–∏—Å–∫–µ –∏–ª–∏ –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã. –ù–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ ‚Äî —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ B-–¥–µ—Ä–µ–≤–æ (B-tree).

–ò–Ω–¥–µ–∫—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —É–∫–∞–∑–∞—Ç–µ–ª–∏ (–∞–¥—Ä–µ—Å–∞) –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ, –∞ –Ω–µ —Å–∞–º–∏ –¥–∞–Ω–Ω—ã–µ:

```text
–ò–Ω–¥–µ–∫—Å –Ω–∞ —Å—Ç–æ–ª–±–µ—Ü "name":
‚îú‚îÄ‚îÄ "–ê–Ω–Ω–∞" ‚Üí —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É #15
‚îú‚îÄ‚îÄ "–ë–æ—Ä–∏—Å" ‚Üí —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É #3  
‚îú‚îÄ‚îÄ "–í–µ—Ä–∞" ‚Üí —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É #27
‚îî‚îÄ‚îÄ "–ò–≥–æ—Ä—å" ‚Üí —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É #8

-- –ª–∏–±–æ

–ò–Ω–¥–µ–∫—Å –Ω–∞ —Å—Ç–æ–ª–±–µ—Ü "department":
‚îú‚îÄ‚îÄ "HR" ‚Üí [—É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É #5, #12, #18, #31]
‚îú‚îÄ‚îÄ "IT" ‚Üí [—É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É #2, #7, #15, #22, #28]  
‚îú‚îÄ‚îÄ "Sales" ‚Üí [—É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É #1, #9, #24]
‚îî‚îÄ‚îÄ "Marketing" ‚Üí [—É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É #6, #11, #17]
```

>[!note] –í–∞–∂–Ω–æ
>–ò–Ω–¥–µ–∫—Å—ã –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### üìë–ö–∞–∫–∏–µ —Ç–∏–ø—ã –∏–Ω–¥–µ–∫—Å–æ–≤ —Å—É—â–µ—Å—Ç–≤—É—é—Ç? 

–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç–æ–ª–±—Ü–æ–≤, –≤—Ö–æ–¥—è—â–∏—Ö –≤ —Å–æ—Å—Ç–∞–≤ –∏–Ω–¥–µ–∫—Å–∞, –≤—ã–¥–µ–ª—è—é—Ç *–æ–¥–∏–Ω–æ—á–Ω—ã–π* –∏ *—Å–æ—Å—Ç–∞–≤–Ω—ã–µ* –∏–Ω–¥–µ–∫—Å—ã. –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –≤–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–æ–ª–±—Ü–µ –≤—ã–¥–µ–ª—è—é—Ç *—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ* –∏ *–Ω–µ—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ* –∏–Ω–¥–µ–∫—Å—ã. –ü–æ –º–µ—Å—Ç—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–∞ –≤—ã–¥–µ–ª—è—é—Ç *–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ* –∏ *–Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ* –∏–Ω–¥–µ–∫—Å—ã.
–í `SQL Server` –µ—â–µ –≤—ã–¥–µ–ª—è—é—Ç –ø–æ–¥–≤–∏–¥ –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ - —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å. *–§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å* - —ç—Ç–æ  –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Å –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–Ω–¥–µ–∫—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏
CREATE INDEX IX_Products_InStock
ON Products(ProductName, Price)
WHERE StockQuantity > 0;
-- –¢–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã,
-- –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏, —á—Ç–æ —É–ª—É—á—à–∏—Ç
-- –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤, –∏—â—É—â–∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
```

–¢–∞–∫–∂–µ –≤ `SQL Server` –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å *–ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã* - –∏–Ω–¥–µ–∫—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å—Ç–æ–ª–±—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É. –ù–∞–ø—Ä–∏–º–µ—Ä, –∞–Ω–∞–ª–∏—Ç–∏–∫—É –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂ –Ω—É–∂–Ω–æ —á–∞—Å—Ç–æ –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–∫–∞–∑–∞—Ö –∫–ª–∏–µ–Ω—Ç–∞, –ø–æ—ç—Ç–æ–º—É –º—ã —á–∞—Å—Ç–æ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –ë–î, —á—Ç–æ–±—ã –≤–∑—è—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã. –î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç–æ–∏—Ç —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥—É—Ç –≤—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ç–æ–ª–±—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω—É–∂–Ω—É—é –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

### üìë–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω–¥–µ–∫—Å b-tree –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º? –ö–∞–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É? 

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ b-tree –∏–Ω–¥–µ–∫—Å–∞ –°–£–ë–î —Å–æ–∑–¥–∞–µ—Ç b-tree —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å —É–∑–ª–∞–º–∏. –ö–∞–∂–¥—ã–π —É–∑–µ–ª —Å–æ–¥–µ—Ä–∂–∏—Ç:
- *–∫–ª—é—á* - –∫–æ–ª–æ–Ω–∫–∞(-–∏), –ø–æ –∫–æ—Ç–æ—Ä–æ–π(-—ã–º) –±—ã–ª —Å–æ–∑–¥–∞–Ω –∏–Ω–¥–µ–∫—Å
- *—É–∫–∞–∑–∞—Ç–µ–ª—å*, –∫–æ—Ç–æ—Ä—ã–π –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —É–∑–ª–∞—Ö —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª, –∞ –≤ –ª–∏—Å—Ç–æ–≤—ã—Ö —É–∑–ª–∞—Ö - –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ

–ö–ª—é—á–µ–π –∏ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –≤ —É–∑–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ, –Ω–æ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —É—Å–ª–æ–≤–∏–µ: –µ—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π - `n`, —Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç `n+1`.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ b-tree –∏–Ω–¥–µ–∫—Å–∞ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–æ–±–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–µ–π—Å—è, —Ç.–µ. –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç *—Å–ø–ª–∏—Ç, —Å–ª–∏—è–Ω–∏–µ –∏ —Ä–æ—Ç–∞—Ü–∏–∏ —É–∑–ª–æ–≤*, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –¥–µ—Ä–µ–≤–∞. –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–µ—Ä–µ–≤–∞ –Ω–µ –Ω—É–∂–Ω—ã. –°–∞–º–æ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: *–≤—Ä–µ–º—è –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–µ—Ä–µ–≤–æ–º —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç O(log n)*

### üìë–í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –∏ –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º?

|                                                  | –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π                                                                                                                  | –ù–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π                                                                                                             |
| ------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ  | –¥–∞                                                                                                                                | –Ω–µ—Ç                                                                                                                            |
| —Å–∫–æ–ª—å–∫–æ —Ç–∞–∫–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ      | **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω**                                                                                                                   | –Ω–µ—Å–∫–æ–ª—å–∫–æ                                                                                                                      |
| –∫–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –º–æ–∂–µ—Ç –≤—Ö–æ–¥–∏—Ç—å –≤ –∏–Ω–¥–µ–∫—Å | **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω**                                                                                                                   | –Ω–µ—Å–∫–æ–ª—å–∫–æ                                                                                                                      |
| –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                      | —Å—Ç—Ä–æ–∫–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–º –ø–æ–ª–µ–º –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –∏–ª–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é | —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–æ–≥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ, –∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã - –¥–µ—Ä–µ–≤–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ |
### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞?

–ü–æ—à–∞–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã–±–∏—Ä–∞–µ—Ç –°–£–ë–î –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞. –ü–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –∫–∞–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã
- –∫–∞–∫–æ–≤–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
- –∫–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –¥–ª—è –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
- –µ—Å–ª–∏ –µ—Å—Ç—å `join`, —Ç–æ –∫–∞–∫ –±—É–¥—É—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ
- –∫–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã

–í `PostgreSQL` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–ª–∞–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `EXPLAIN` –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º. –ß–∞—Å—Ç–æ `EXPLAIN` –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ [[EXPLAIN attributes|–∞—Ç—Ä–∏–±—É—Ç–∞–º–∏]]:
- `EXPLAIN (ANALYZE, BUFFERS)` - –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- `EXPLAIN (ANALYZE, FORMAT JSON)` - –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞–Ω–æ–≤
- `EXPLAIN (ANALYZE, VERBOSE, BUFFERS, WAL, SETTINGS ON)` - –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
- `EXPLAIN (ANALYZE, FORMAT YAML)` - –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞

### üìë–ö–∞–∫ –∏–Ω–¥–µ–∫—Å –º–æ–∂–µ—Ç –Ω–∞–≤—Ä–µ–¥–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?

- *–∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –≤—Å—Ç–∞–≤–∫–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è*: –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ –∏–Ω–¥–µ–∫—Å —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω, —á—Ç–æ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å —ç—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏

- *–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ*: –∏–Ω–¥–µ–∫—Å—ã —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º —á–∏—Ç–∞–π –ø–æ üîó[[–ò–Ω–¥–µ–∫—Å –≤ –ë–î|—Å—Å—ã–ª–∫–µ#1]] –∏ üîó[[–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω–¥–µ–∫—Å—ã –≤ RDBMS|—Å—Å—ã–ª–∫–µ#2]] 

–•–æ—Ä–æ—à–æ –±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å üìπ:
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–æ–±–µ—Å—É - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤: https://www.youtube.com/watch?v=JCSv9RDP_lY

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ–∫–∞—Ä—Ç–æ–≤ –≤–∑—Ä—ã–≤?

**[[–î–µ–∫–∞—Ä—Ç–æ–≤ –≤–∑—Ä—ã–≤ ¬∑ –î–µ–∫–∞—Ä—Ç–æ–≤–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (Cartesian Product)|–î–µ–∫–∞—Ä—Ç–æ–≤ –≤–∑—Ä—ã–≤]]** - —ç—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –ø—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è JOIN –ø–æ–ª—É—á–∞–µ—Ç—Å—è **–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ** –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ –∏–∑ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü.

**–ü—Ä–∏—á–∏–Ω—ã –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è:**

- –∑–∞–±—ã–ª–∏ —É—Å–ª–æ–≤–∏–µ JOIN
- —É—Å–ª–æ–≤–∏–µ –≤ JOIN –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `JOIN orders o ON u.age > 18;` - —ç—Ç–æ —É—Å–ª–æ–≤–∏–µ –Ω–µ —Å–≤—è–∑—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã)
- –º–Ω–æ–≥–æ —Ç–∞–±–ª–∏—Ü –±–µ–∑ —Å–≤—è–∑–∏ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º (`FROM table1 t1, table2 t2, table3 t3, table4 t4`)

**–ö–∞–∫ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å [[–î–µ–∫–∞—Ä—Ç–æ–≤ –≤–∑—Ä—ã–≤ ¬∑ –î–µ–∫–∞—Ä—Ç–æ–≤–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (Cartesian Product)|–¥–µ–∫–∞—Ä—Ç–æ–≤ –≤–∑—Ä—ã–≤]]:**

- `EXPLAIN (ANALYZE, BUFFERS)`: –≤ –≤—ã–¥–∞—á–µ –±—É–¥–µ—Ç `Nested Loop –∏–ª–∏ CROSS JOIN ...`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
- –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ `SELECT`
- –ø–æ–ª—É—á–∏–ª–∏ –Ω–µ —Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—Ç–µ–ª–∏

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å [[–î–µ–∫–∞—Ä—Ç–æ–≤ –≤–∑—Ä—ã–≤ ¬∑ –î–µ–∫–∞—Ä—Ç–æ–≤–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (Cartesian Product)|–¥–µ–∫–∞—Ä—Ç–æ–≤–∞ –≤–∑—Ä—ã–≤–∞]]:**

- –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `JOIN` —Å —è–≤–Ω—ã–º —É—Å–ª–æ–≤–∏–µ–º
- –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç—è–∂–µ–ª—ã–π –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º: –µ—Å–ª–∏ –≤ –≤—ã–≤–æ–¥–µ –µ—Å—Ç—å `Nested Loop –∏–ª–∏ CROSS JOIN ...`, —Ç–æ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫

## üìî–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏

#priority/üî•high #üìëtheory/üß†sql 

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è? –ó–∞—á–µ–º –Ω—É–∂–Ω–∞?

*–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è* - –Ω–∞–±–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –≤—Å–µ, –ª–∏–±–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –Ω–∏ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∏–∑ –Ω–∞–±–æ—Ä–∞. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø—É—Ç–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ `ACID`

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ ACID?

–ü—Ä–∏–Ω—Ü–∏–ø—ã, —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î.

|                                 | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ                                                                                                           | –ö–∞–∫ –ø–æ–º–æ–≥–∞–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö                                  |
| ------------------------------- | --------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å (`Atomicity`)       | –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ª–∏–±–æ –≤–µ—Å—å –Ω–∞–±–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–π, –ª–∏–±–æ –Ω–∏ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∏–∑ –Ω–∞–±–æ—Ä–∞                                                  | –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö                        |
| –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (`consistency`) | –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ "good state", —Ç.–µ. —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—Ç –Ω–∞–±–æ—Ä—É –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤                                       | —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö                        |
| –ò–∑–æ–ª—è—Ü–∏—è (`isolation`)          | –µ—Å–ª–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ç–æ –∫ –¥–∞–Ω–Ω—ã–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø—Ä–∏ –ø–æ–º–æ—â–∏ —É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏ | –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç "–≥—Ä—è–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" –∏ "—Ñ–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ"                |
| –î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å (`durability`)    | –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –∞ –Ω–µ –ª–µ–∂–∞—Ç –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏                  | –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ `COMMIT` –Ω–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã –¥–∞–∂–µ –ø—Ä–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–±–æ—è—Ö |

### üìë–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –∏ –∞–Ω–æ–º–∞–ª–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—à–∞—é—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ (–≤–æ–æ–±—â–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –°–£–ë–î)

| –£—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏              | **–ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ** (Dirty Read) | **–ù–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —á—Ç–µ–Ω–∏–µ** (Non-repeatable Read) | **–§–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ** (Phantom Read) | **–ê–Ω–æ–º–∞–ª–∏—è –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (Lost Update) | **–ß—Ç–µ–Ω–∏–µ-–∑–∞–ø–∏—Å—å —Å –ø—Ä–æ–ø—É—Å–∫–æ–º** (Skipped Read/Write Skew) |
| ----------------------------- | ------------------------------- | ------------------------------------------------ | ----------------------------------- | ------------------------------------------------- | ------------------------------------------------------- |
| `Serialisable`                | ‚úÖ                               | ‚úÖ                                                | ‚úÖ                                   | ‚úÖ                                                 | ‚úÖ                                                       |
| `Snapshot or Repeatable Read` | ‚úÖ                               | ‚úÖ                                                | ‚ùå                                   | ‚úÖ                                                 | ‚ùå                                                       |
| `Read Commited`               | ‚úÖ                               | ‚ùå                                                | ‚ùå                                   | ‚ùå                                                 | ‚ùå                                                       |
| `Read Uncommited`             | ‚ùå                               | ‚ùå                                                | ‚ùå                                   | ‚ùå                                                 | ‚ùå                                                       |
–í–∏–¥—ã –∞–Ω–æ–º–∞–ª–∏–π:
- **–≥—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ** (`dirty read`): —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥—Ä—É–≥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–Ω–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —á—Ç–µ–Ω–∏–µ** (`non-repeatable read`): –ø–æ–≤—Ç–æ—Ä–Ω—ã–π `SELECT` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–æ
- **—Ñ–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ** (`phantom read`): –ø–æ–≤—Ç–æ—Ä–Ω—ã–π `SELECT` –ø–æ —É—Å–ª–æ–≤–∏—é (WHERE) `–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç` –¥—Ä—É–≥–æ–π –Ω–∞–±–æ—Ä —Å—Ç—Ä–æ–∫, –ø–æ—Ç–æ–º—É —á—Ç–æ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–ª–∏ —É–¥–∞–ª–µ–Ω—ã —Å—Ç—Ä–æ–∫–∏, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–µ —É—Å–ª–æ–≤–∏—é
- **–∞–Ω–æ–º–∞–ª–∏—è –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (`lost update`): –¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—é—Ç –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞—Ç–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥—Ä—É–≥–æ–π, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–æ ¬´–ø–æ—Ç–µ—Ä—è–Ω–æ¬ª ^3a87e6
- **—á—Ç–µ–Ω–∏–µ-–∑–∞–ø–∏—Å—å —Å –ø—Ä–æ–ø—É—Å–∫–æ–º** (`skipped read/write skew`): –¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ, –∞ –∑–∞—Ç–µ–º –ø–∏—à—É—Ç –≤ —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏. –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Ä—É—à–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ –±—ã–ª–∞ –ª–æ–≥–∏—á–Ω–∞

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ–¥–ª–æ–∫? –ü—Ä–∏–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥–µ–¥–ª–æ–∫—É
 
**–í–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** (`deadlock`) - —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ 1 –∂–¥–µ—Ç —Ä–µ—Å—É—Ä—Å, –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π 2, –∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ 2 –∂–¥–µ—Ç —Ä–µ—Å—É—Ä—Å, –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π 1. 

![[Pasted image 20250424162652.png]]

–ï—â–µ —Å–º–æ—Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä –ø–æ [[–ü—Ä–æ–¥–∞–∫—à–Ω –ø—Ä–∏–º–µ—Ä deadlock –≤ –ë–î|—Å—Å—ã–ª–∫–µ]]

### üìë–í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–π –∏ –ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π?

|                            | –ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (`Pessimistic Locking`)                                    | –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (`Optimistic Locking`)                                                                |
| -------------------------- | ------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------- |
| —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è            | –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è                                       | –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è, –Ω–æ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º  –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, –±—ã–ª–∏ –ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∏–∑–º–µ–Ω–µ–Ω—ã |
| –∫–∞–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ —á–µ—Ä–µ–∑ `SELECT ... FOR UPDATE`                             | –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É —Å—Ç–æ–ª–±—Ü–æ–≤ –≤—Ä–æ–¥–µ `updated_at` –∏–ª–∏ `field-version`                                     |
| –º–∏–Ω—É—Å—ã                     | - –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å `deadlocks`<br>- –º–æ–≥—É—Ç —Å–Ω–∏–∑–∏—Ç—å—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º | - –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é<br>- –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≤—ã—Å–æ–∫–æ–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥–µ                             |
| –ø—Ä–∏–º–µ—Ä—ã, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è  | –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –±–∏–ª–µ—Ç—ã                                    | CMS, REST API, UI-—Ñ–æ—Ä–º—ã, –≥–¥–µ –º–µ–Ω—å—à–µ —à–∞–Ω—Å–æ–≤ –Ω–∞ –∫–æ–ª–ª–∏–∑–∏–∏                                                         |


–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏: https://habr.com/ru/articles/857486/
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: [[–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è vs –ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞]]

## üìî–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#priority/‚ùÑÔ∏èmedium #üìëtheory/üß†sql
### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏? –ö–∞–∫ –æ—Ç –Ω–∏—Ö –∑–∞—â–∏—Ç–∏—Ç—å—Å—è?

`SQL-–∏–Ω—ä–µ–∫—Ü–∏—è` - –º–µ—Ç–æ–¥ –∞—Ç–∞–∫–∏ –Ω–∞ –≤–µ–±-—Ä–µ—Å—É—Ä—Å, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π `SQL-–∫–æ–¥` –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `HTTP-–∑–∞–ø—Ä–æ—Å–∞`. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä `SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏`:

```sql
SELECT * FROM users WHERE username = 'admin' OR '1'='1'
```

–£—Å–ª–æ–≤–∏–µ `'1'='1'` –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `true`, –ø–æ—ç—Ç–æ–º—É –æ—Ç–ø—Ä–∞–≤–∫–∞ `HTTP-–∑–∞–ø—Ä–æ—Å–∞` —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `query-–ø–∞—Ä–∞–º–µ—Ç—Ä–µ` –¥–∞—Å—Ç –≤ –æ—Ç–≤–µ—Ç –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–ª–∏—Ü—ã `users`.
–°–ø–æ—Å–æ–±—ã –∑–∞—â–∏—Ç—ã –æ—Ç `SQL-–∏–Ω—ä–µ–∫—Ü–∏–π`:
- –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—Å–µ–≥–æ —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ORM` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `ORM` –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î, —Ç.–µ. –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –ë–î –Ω–µ –∫–∞–∫ `SQL-–∫–æ–¥`, –∞ –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ –¥–∞–Ω–Ω—ã–µ)
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥ `ORM` + –º–∏–≥—Ä–∞—Ü–∏–∏
- –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –ë–î)
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω (`WAF`)

## üìîPostgreSQL

#priority/‚ùÑÔ∏èmedium #üìëtheory/üß†sql

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ MVCC? –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–æ? –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

*[[MVCC (multiversion concurrency control)|MVCC]] (multiversion concurrency control)* - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –°–£–ë–î –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π –æ–¥–Ω–æ –∏ —Ç–æ–≥–æ –∂–µ –æ–±—ä–µ–∫—Ç–∞ (—Å–≤–æ–µ–≥–æ —Ä–æ–¥–∞ –º–µ—Ö–∞–Ω–∏–∑–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î). –û—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –≥—Ä—É–ø–ø–µ [[17 ¬∑ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏|–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫]]. **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** [[MVCC (multiversion concurrency control)|MVCC]] - –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —ç—Ç–∏—Ö —Å–∞–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö. <br/>

–í `PostgreSQL` –¥–∞–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫–∏ (`xmin, xmax, cmin`, –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ [[MVCC ¬∑ –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã|–∑–∞–º–µ—Ç–∫–µ]]) –∏ `snapshot` - —Å–Ω–∏–º–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î (–¥–∞–Ω–Ω—ã—Ö –≤ –Ω–µ–π) –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.<br/>

–ö–æ–≥–¥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ, —Ç–æ –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∫–æ–ø–∏—è —Å—Ç—Ä–æ–∫–∏. –ü—Ä–∏ —á–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –∑–∞ —Å—á–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤—Ä–æ–¥–µ `xmin, xmax, cmin` –∏ –ø—Ä–æ—á.). –ï—Å–ª–∏ –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç—É —Å —ç—Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–æ–π, —Ç–æ –æ–Ω–∞ –Ω–µ –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ç.–∫. –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫–∏ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–º–µ—á–µ–Ω—ã  –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
<br/>

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ WAL –∏ –∑–∞—á–µ–º –Ω—É–∂–µ–Ω?

*WAL* (`write ahead log` –∏–ª–∏ –∂—É—Ä–Ω–∞–ª –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏, –∞–Ω–∞–ª–æ–≥ `Transaction Log` –≤ `SQL Server`) - —Ñ—É–Ω–∫—Ü–∏—è –°–£–ë–î, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –æ—Ç–∫–∞–∑–æ–≤. `WAL` —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –Ω–∞–±–æ—Ä –∑–∞–ø–∏—Å–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Ä–∞–∂–∞—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏–µ –≤ –ë–î —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ `checkpoint` (—á–∏—Ç–∞–π [[–í–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ PostgreSQL_ –∂—É—Ä–Ω–∞–ª –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏ (WAL) _ –ó–∞–ø–∏—Å–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞.pdf|–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ]] –∏–ª–∏ –ø–æ [—Å—Å—ã–ª–∫–µ](#https://eax.me/postgresql-wal/)).
<br/>

### üìë–ö–∞–∫–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã –¥–ª—è PostgreSQL? (–¥–µ—Ç–∞–ª—å–Ω–æ —á–∏—Ç–∞–π –≤ [[üîπ–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è PostgreSQL|–∑–∞–º–µ—Ç–∫–µ]])

- `JSOB` -  –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `JSON`, –∫–æ—Ç–æ—Ä—ã–π –±—ã—Å—Ç—Ä–µ–µ –∏ –ø–æ –Ω–µ–º—É –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
- `UUID` - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `GUID`
- `GEOMETRY` / `GEOGRAPHY` - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤—Ä–æ–¥–µ –º–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫, –¥–æ–ª–≥–æ—Ç–∞ –∏ —à–∏—Ä–æ—Ç–∞ 
<br/>

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ JSONB? –í —á–µ–º –µ–≥–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ JSON?

–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –¥–ª—è `PostgreSQL` —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç`json` –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã (`GIN, B-tree`) –ø–æ –Ω–µ–º—É.

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ –≤–∞–∫—É—É–º (VACUUM)?

PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç¬†**MVCC (Multi-Version Concurrency Control)**¬†- –ø—Ä–∏ UPDATE/DELETE —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É, –∞ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ "–º–µ—Ä—Ç–≤—ã–µ" (dead tuples).

–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫ (dead tupldes) –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (bloat). –¢–∞–∫–∂–µ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å [[–§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤|—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤]], –∞ [[PostgreSQL ¬∑ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ (Query Planner)|–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤]] –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–±–æ—Ç–µ —É—Å—Ç–∞—Ä–µ–≤—à—É—é [[–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ PostgreSQL|—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É]].

>[!note] Notion
**–í–∞–∫—É—É–º (VACUUM)** - –ø—Ä–æ—Ü–µ—Å—Å "—É–¥–∞–ª–µ–Ω–∏—è" –º–µ—Ä—Ç–≤—ã—Ö —Å—Ç—Ä–æ–∫ –≤ PostgreSQL, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö UPDATE/DELETE –æ–ø–µ—Ä–∞—Ü–∏—è—Ö.

–í–∏–¥—ã –≤–∞–∫—É—É–º–∞:

- `–æ–±—ã—á–Ω—ã–π`: [[–ö–∞–∫ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞|–æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–æ–≤, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä —Å–∞–º–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è]]. –ü—Ä–∏ —ç—Ç–æ–º:
	- —É–¥–∞–ª—è—é—Ç—Å—è dead tuples
	- –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è [[–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ PostgreSQL|—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞]] (***–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è ANALYZE***)
	- –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
	- —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ **–ù–ï –ë–õ–û–ö–ò–†–£–Æ–¢–°–Ø**

- `–ø–æ–ª–Ω—ã–π`: –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞. –ü—Ä–∏ —ç—Ç–æ–º:
	- –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–∞–∫—É—É–º–∞ –º–µ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –û–°
	- —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤–∞–∫—É—É–º–∞ **–ë–õ–û–ö–ò–†–£–ï–¢–°–Ø** (—ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
	- —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ —É–¥–≤–∞–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä)

- `analyze`: **–æ–±—ã—á–Ω—ã–π –≤–∞–∫—É—É–º + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ [[–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ PostgreSQL|—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏]]**

–ï—â–µ –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç—å—é: [–°–µ–º—å —Ñ–∞–∑ –≤–∞–∫—É—É–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PostgreSQL](#https://habr.com/ru/articles/888854/)

## üìî–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#priority/‚ùÑÔ∏èmedium #üìëtheory/üß†sql

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è?

–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö. –í –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π —Ç–µ–æ—Ä–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã. –ß–∞—â–µ –≤—Å–µ–≥–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –≤—ã–¥–µ–ª—è—Ç —Å–ª–µ–¥—É—é—â–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã:
- 1–ù–§: –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ 1–ù–§ —Ç–æ–≥–¥–∞ –∏ —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –≤—Å–µ –µ–≥–æ –∞—Ç—Ä–∏–±—É—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç.–µ. —è–≤–ª—è—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏

- 2–ù–§: –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ 2–ù–§, –µ—Å–ª–∏ –æ–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ 1–ù–§ –∏ –∫–∞–∂–¥—ã–π –Ω–µ–∫–ª—é—á–µ–≤–æ–π –∞—Ç—Ä–∏–±—É—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ (–µ—Å–ª–∏ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ—Å—Ç–∞–≤–Ω–æ–π, —Ç–æ –æ—Ç –Ω–µ–≥–æ —Ü–µ–ª–∏–∫–æ–º, –∞ –Ω–µ –æ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏)

- 3–ù–§: –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ 3–ù–§, –µ—Å–ª–∏ –æ–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ 2–ù–§ –∏ –º–µ–∂–¥—É –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏[^1]

### üìë–ö–æ–≥–¥–∞ —Å—Ç–æ–∏—Ç –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö?

- —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î

- –Ω—É–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `join`

- –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Ä–µ–¥–∫–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è, –Ω–æ –æ—á–µ–Ω—å —á–∞—Å—Ç–æ —á–∏—Ç–∞—é—Ç—Å—è, —Ç–æ –ø—Ä–æ—â–µ —Ö—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª—å, —á–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–µ–ª–∞—Ç—å `join` –≤ –¥—Ä—É–≥–æ–π —Ç–∞–±–ª–∏—Ü–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ö—Ä–∞–Ω–∏—Ç—å `product_name` –≤ —Ç–∞–±–ª–∏—Ü–µ `order_items`, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ `products`)

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ? –ó–∞—á–µ–º –Ω—É–∂–Ω–æ?

**–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —à–∞—Ä–¥–∏–Ω–≥** - –≤–∏–¥ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è (`partition` - —Ä–∞–∑–¥–µ–ª—è—Ç—å, —Ä–∞—Å—á–ª–µ–Ω—è—Ç—å), –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏ (—à–∞—Ä–¥—ã) –∏ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–∞—Ö –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞—Ö.

–Ø–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ë–î. –ü–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∑–∞ —Å—á–µ—Ç —Ç–æ–≥–æ, —á—Ç–æ –∑–∞–¥–∞—á–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –ë–î (—á–∏—Ç–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ [—Å—Å—ã–ª–∫–µ](#https://platformv.sbertech.ru/blog/masshtabirovanie-baz-dannyh), –∞ —Ç–∞–∫–∂–µ –≤ [–∏—Å—Ç–æ—á–Ω–∏–∫–µ](#https://yandex.cloud/ru/docs/glossary/sharding?utm_referrer=https%3A%2F%2Fwww.google.com%2F)).

–ú–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å —à–∞—Ä–¥—ã ***–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ*** (–∫–æ–≥–¥–∞ –Ω–∞ –¥—Ä—É–≥–æ–π —É–∑–µ–ª –∑–∞–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±—Ä–∞–Ω–Ω–∞—è –ø–æ —É—Å–ª–æ–≤–∏—é) –ª–∏–±–æ ***–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ*** (–∫–æ–≥–¥–∞ –Ω–∞ –¥—Ä—É–≥–æ–π —É–∑–µ–ª –∑–∞–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è —á–∞—Å—Ç—å —Å—Ç–æ–ª–±—Ü–æ–≤)

>[!danger] **–í–∞–∂–Ω–æ**
>
>–®–∞—Ä–¥–∏–Ω–≥ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è - –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –°–£–ë–î. –°–µ–≥–æ–¥–Ω—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –°–£–ë–î –∏–º–µ—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

### üìë–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è? –ó–∞—á–µ–º –Ω—É–∂–Ω–∞?

**–†–µ–ø–ª–∏–∫–∞—Ü–∏—è** ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω–µ—Å–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –∏—Ö —á—Ç–µ–Ω–∏–µ –∏–∑ —Å–≤–æ–µ–π –∫–æ–ø–∏–∏, —Ç–æ–≥–¥–∞ –∫–∞–∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–ø–∏—Å–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è —á—Ç–µ–Ω–∏—è.

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã—Ä–∞—Å—Ç–∞–µ—Ç –∑–∞ —Å—á–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ—á–µ–∫, –≤ –∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á. 

**–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —à–∞—Ä–¥–∏–Ω–≥–∞ –∫–∞–∂–¥—ã–π –∏–∑ —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã.**

–ß–∞—â–µ –≤—Å–µ–≥–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –ø–æ–¥—Ö–æ–¥ `master-slave`(—Å–º. —Ä–∏—Å—É–Ω–æ–∫ –Ω–∏–∂–µ).

![[Pasted image 20250430141822.png|300]]

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é —á–∏—Ç–∞–π –≤ –∑–∞–º–µ—Ç–∫–∞—Ö [[–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö|1]] –∏ [[–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ|2]]

[^1]: –¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å - —ç—Ç–æ –∫–æ–≥–¥–∞ `A -> B, B -> C, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ A -> C`, –≥–¥–µ `->`- –∑–∞–≤–∏—Å–∏—Ç


### üìë–¢–µ–æ—Ä–µ–º–∞ –°–ê–†

**CAP-—Ç–µ–æ—Ä–µ–º–∞ (Consistency, Availability, Partition tolerance)**¬†‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

–û–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç:

> **–í –ª—é–±–æ–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ**¬†–º–æ–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å¬†**—Ç–æ–ª—å–∫–æ –¥–≤–∞**¬†–∏–∑ —Ç—Ä—ë—Ö —Å–≤–æ–π—Å—Ç–≤¬†_(In any distributed system, only two of the three properties can be achieved simultaneously)_:  
> **C**onsistency (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å),  
> **A**vailability (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å),  
> **P**artition tolerance (—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é —Å–µ—Ç–∏).


üî∫–¢—Ä–∏ –±—É–∫–≤—ã ‚Äî —Ç—Ä–∏ —Å–≤–æ–π—Å—Ç–≤–∞:

| –°–≤–æ–π—Å—Ç–≤–æ                    | –ß—Ç–æ –∑–Ω–∞—á–∏—Ç                                                                                                                                                                   |
| --------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Consistency (C)**         | –í—Å–µ —É–∑–ª—ã –≤–∏–¥—è—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤—Ä–µ–º—è  <br>**All nodes see the same data at the same time.**                                                               |
| **Availability (A)**        | –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç ‚Äî –ø—É—Å—Ç—å –¥–∞–∂–µ –Ω–µ —Å–∞–º—ã–π —Å–≤–µ–∂–∏–π  <br>**Every request gets a response - even if it's not the latest one**                                           |
| **Partition Tolerance (P)** | –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ —á–∞—Å—Ç—å —Å–µ—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ "–ø–æ—Ä–≤–∞–ª–∞—Å—å"  <br>**The system continues to operate even if part of the network is unavailable or "broken"** |

‚ö†Ô∏è¬†**–¢–µ–æ—Ä–µ–º–∞**:

> –ü—Ä–∏¬†**—Å–µ—Ç–µ–≤–æ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ (Partition)**¬†–≤—ã¬†**–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω—ã –≤—ã–±—Ä–∞—Ç—å –º–µ–∂–¥—É:**
> 
> - **Consistency**¬†–∏–ª–∏  
> - **Availability**  
>     

üìå–¢–æ –µ—Å—Ç—å:¬†**P –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**¬†–≤ —Ä–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è –≤—ã–±–æ—Ä –º–µ–∂–¥—É C –∏ A.

üß† **–ò—Ç–æ–≥–æ**:

|CAP-—Å–≤–æ–π—Å—Ç–≤–æ|–ß—Ç–æ —ç—Ç–æ|
|---|---|
|C ‚Äî –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å|–í—Å–µ —É–∑–ª—ã –≤–∏–¥—è—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ|
|A ‚Äî –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å|–°–∏—Å—Ç–µ–º–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å|
|P ‚Äî –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é|–†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏|

**–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–≤–∞ –∏–∑ —Ç—Ä—ë—Ö!**