**Large Object Heap (LOH)** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ –≤ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π –∫—É—á–µ .NET, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è **–∫—Ä—É–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤**.

---

## **üìå –ß—Ç–æ —Ç–∞–∫–æ–µ LOH –∏ –∑–∞—á–µ–º –æ–Ω–∞ –Ω—É–∂–Ω–∞?**

–í .NET —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è –∫—É—á–∞ (Managed Heap) —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π:

1. **Small Object Heap (SOH)** ‚Äì –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–º–µ–Ω—å—à–µ 85 KB).
2. **Large Object Heap (LOH)** ‚Äì –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (85 KB –∏ –±–æ–ª—å—à–µ).
3. **Pinned Object Heap (POH)** ‚Äì –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã—Ö (pinned) –æ–±—ä–µ–∫—Ç–æ–≤ (–Ω–∞—á–∏–Ω–∞—è —Å .NET 5).

**LOH –Ω—É–∂–Ω–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞ (GC)**, —Ç–∞–∫ –∫–∞–∫ –∫—Ä—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã:

- **–î–æ–ª–≥–æ –∂–∏–≤—É—Ç –≤ –ø–∞–º—è—Ç–∏** (—Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è).
- **–†–µ–¥–∫–æ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è** (GC —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –∏—Ö, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–æ–ª—å—à–∏—Ö –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ).

---

## **üìå –ö–∞–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ LOH?**

- **–ú–∞—Å—Å–∏–≤—ã —Ä–∞–∑–º–µ—Ä–æ–º ‚â• 85 KB** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `byte[85_000]`, `int[21_250]`, `double[10_625]`).
- **–°—Ç—Ä–æ–∫–∏ (string), –µ—Å–ª–∏ –æ–Ω–∏ –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100 000+ —Å–∏–º–≤–æ–ª–æ–≤).
- **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–∏–µ**.

---

## **üìå –ö–∞–∫ GC —Ä–∞–±–æ—Ç–∞–µ—Ç —Å LOH?**

1. **LOH –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Ç–∞–∫ —á–∞—Å—Ç–æ, –∫–∞–∫ SOH** (–æ–±—ã—á–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º —Å–±–æ—Ä–µ –º—É—Å–æ—Ä–∞ **(Gen 2 GC)**).
2. **–û–±—ä–µ–∫—Ç—ã –≤ LOH –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è**, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –¥–æ—Ä–æ–≥–æ (GC –Ω–µ —Ö–æ—á–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å 100+ KB –ø–∞–º—è—Ç–∏).
3. **–ü–∞–º—è—Ç—å –≤ LOH –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ**, –ø–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

---

## **üìå –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å LOH**

### üîπ **1. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—Ä—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã**

–ï—Å–ª–∏ –≤—ã —á–∞—Å—Ç–æ —Å–æ–∑–¥–∞—ë—Ç–µ –∏ —É–¥–∞–ª—è–µ—Ç–µ –º–∞—Å—Å–∏–≤—ã >85 KB, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ **ArrayPool**:

```csharp
var pool = System.Buffers.ArrayPool<byte>.Shared;
byte[] buffer = pool.Rent(100_000); // –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ –∏–∑ –ø—É–ª–∞

// –ò—Å–ø–æ–ª—å–∑—É–µ–º buffer...

pool.Return(buffer); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –≤ –ø—É–ª
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –∏–∑–±–µ–≥–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã—Ö [[üìå –ê–ª–ª–æ–∫–∞—Ü–∏—è (Allocation) –≤ .NET|–∞–ª–ª–æ–∫–∞—Ü–∏–π]] –≤ LOH.

### üîπ **2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `StringBuilder` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏**

```csharp
var sb = new System.Text.StringBuilder(100_000); // –ò–∑–±–µ–≥–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∞–ª–ª–æ–∫–∞—Ü–∏–π –≤ LOH
sb.Append("–ë–æ–ª—å—à–∞—è —Å—Ç—Ä–æ–∫–∞...");
```

### üîπ **3. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤**

–ß–∞—Å—Ç–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ **–±–æ–ª—å—à–∏—Ö –º–∞—Å—Å–∏–≤–æ–≤ –∏–ª–∏ —Å—Ç—Ä–æ–∫** –≤–µ–¥—ë—Ç –∫ **—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏**.

### üîπ **4. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–π—Ç–µ GC (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)**

–ò–Ω–æ–≥–¥–∞ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å **GC.Collect()**, –Ω–æ —ç—Ç–æ **–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –±–µ–∑ –æ—Å—Ç—Ä–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

## **üìå –ò—Ç–æ–≥**

- **LOH —Ö—Ä–∞–Ω–∏—Ç –∫—Ä—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (‚â• 85 KB), –Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ–ª—å—à–∏–µ –º–∞—Å—Å–∏–≤—ã –∏ —Å—Ç—Ä–æ–∫–∏.**
- **GC —Ä–µ–∂–µ –æ—á–∏—â–∞–µ—Ç LOH, –ø–æ—ç—Ç–æ–º—É –ø–∞–º—è—Ç—å –º–æ–∂–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è.**
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—Ä—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (ArrayPool, StringBuilder) –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.**

üî• **–í—ã–≤–æ–¥:** **LOH –ø–æ–º–æ–≥–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫—Ä—É–ø–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, –Ω–æ –µ—ë –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑—É–º–Ω–æ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é.**