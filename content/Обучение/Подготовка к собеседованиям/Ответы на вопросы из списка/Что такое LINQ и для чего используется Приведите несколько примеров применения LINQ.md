---
уровень: "[[junior]]"
секция: платформа .NET
пройдено: 
теги: 
дата: 2024-05-02
время: 19:45
---
![[Pasted image 20240911203344.png]]


`LINQ` — это встроенный в C# механизм для удобной работы с коллекциями.

```csharp
public List<int> GetNewLetterIds_ClassicWay()
{
	var res = new List<int>();
	for(int i=0; i<letters.Length; i++)
	{
		if (letters[i].IsNew)
			res.Add(letters[i].Id);
	}
	return res;
}

public IEnumerable<int> GetNewLetterIds_LinqWay()
{
	return letters.Where(letter => letter.IsNew).Select(letter => letter.Id);
}
```

\+ также операции в классах-репозиториях

LINQ поддерживает типизированные и нетипизированные запросы

1. **Типизированные запросы** - это запросы, которые работают с коллекциями и типами, определенными в .NET, и их результатами, которые также имеют известный тип. Например, когда вы выполняете запрос LINQ на коллекции типа `List<int>`, весь процесс запроса, включая его результаты, хорошо типизирован, и компилятор знает, как обрабатывать эти типы.

```csharp
List<int> numbers = new List<int> { 1, 2, 3, 4, 5 };
var evenNumbers = numbers.Where(n => n % 2 == 0).ToList(); // evenNumbers будет List<int>
```

2. **Нетипизированные запросы** (или динамические запросы) могут быть связаны с использованием `IEnumerable` или `IQueryable`, где тип результата может быть не известен до времени выполнения. Например, если вы работаете с LINQ to SQL или LINQ to Entities, данные извлекаются из базы данных, и результатом может быть `IQueryable` без строгой типизации.

```csharp
IQueryable<dynamic> query = dbContext.Employees.Select(e => new { e.Name, e.Age });
```

  В данном случае, `query` имеет динамический тип, и вы можете извлечь данные, не имея заранее определённого типа результата.

>*Только использование `dynamic` в качестве типа будет делать запрос нетипизированным*

### Недостатки использования `dynamic`:

1. **Нет проверки типов на этапе компиляции**: Ошибки, связанные с типами, могут проявиться только во время выполнения, что делает код более уязвимым.
2. **Отсутствие автозавершения**: IDE не сможет предоставлять подсказки для свойств и методов, поскольку они не будут известны статически.
3. **Производительность**: Использование `dynamic` может иметь отрицательное влияние на производительность, так как требуется дополнительное время для обработки типов во время выполнения.

### Когда использовать `dynamic`:

Использование `dynamic` может быть оправдано в некоторых сценариях, например, при работе с данными, структура которых заранее не известна (например, при работе с JSON, динамическими веб-сервисами и т.д.). Однако в большинстве случаев, особенно в типобезопасных языках вроде C#, рекомендуется использовать четко заданные типы данных для обеспечения безопасности и удобства работы с кодом.
### Основные моменты:

- **Типизированные запросы**: работают с конкретными типами данных, известными на этапе компиляции, что облегчает отладку и повышает безопасность типов.
- **Нетипизированные запросы**: могут работать с данными динамически, но это может усложнить отладку и использование, поскольку ошибки могут проявляться только время выполнения.

### Так говорил ChatGPT

**LINQ** (Language Integrated Query) — это мощная технология в .NET, которая предоставляет единообразный способ работы с данными из различных источников, таких как коллекции объектов, базы данных, XML-документы и другие. LINQ позволяет писать запросы к данным прямо в коде на языке C#, Visual Basic или F#, что делает работу с данными более простой и интуитивно понятной.

### Основные особенности LINQ:

1. **Единообразный синтаксис:**
   - LINQ предоставляет единый синтаксис для работы с разными типами данных, будь то коллекции в памяти, базы данных или XML-документы. Это означает, что разработчик может использовать один и тот же подход для работы с различными источниками данных.

2. **Интеграция с языком:**
   - LINQ является частью самого языка программирования, что позволяет выполнять запросы к данным так же, как и обычные операции над объектами.

3. **Типизированные запросы:**
   - LINQ поддерживает статическую типизацию, что позволяет обнаруживать ошибки на этапе компиляции, а не во время выполнения.

4. **Поддержка IntelliSense:**
   - Поскольку запросы LINQ являются частью языка, они поддерживают IntelliSense в IDE, что облегчает написание и отладку кода.

### Примеры использования LINQ:

1. **LINQ to Objects:**
   - Позволяет выполнять запросы к коллекциям объектов в памяти (например, массивы, списки и т. д.).
   
   ```csharp
   int[] numbers = { 1, 2, 3, 4, 5, 6 };
   var evenNumbers = from num in numbers
                     where num % 2 == 0
                     select num;
   
   foreach (var n in evenNumbers)
   {
       Console.WriteLine(n);
   }
   ```

2. **LINQ to SQL:**
   - Используется для работы с базами данных SQL Server, предоставляя возможность писать запросы на C# вместо SQL.

   ```csharp
   using (var context = new MyDbContext())
   {
       var query = from student in context.Students
                   where student.Age > 18
                   select student;

       foreach (var student in query)
       {
           Console.WriteLine(student.Name);
       }
   }
   ```

3. **LINQ to XML:**
   - Позволяет легко выполнять запросы к XML-документам.

   ```csharp
   XDocument doc = XDocument.Load("books.xml");
   var books = from b in doc.Descendants("book")
               where (int)b.Element("price") > 20
               select b.Element("title").Value;

   foreach (var title in books)
   {
       Console.WriteLine(title);
   }
   ```

4. **LINQ to Entities (Entity Framework):**
   - Используется для запросов к данным через Entity Framework, что позволяет работать с базой данных через объектную модель.

   ```csharp
   using (var context = new MyDbContext())
   {
       var products = from p in context.Products
                      where p.Price > 100
                      select p;

       foreach (var product in products)
       {
           Console.WriteLine(product.Name);
       }
   }
   ```

### Зачем используется LINQ:

1. **Упрощение работы с данными:**
   - LINQ значительно упрощает доступ к данным, предоставляя интуитивно понятный синтаксис для выполнения запросов, что позволяет писать меньше кода.

2. **Читаемость кода:**
   - Запросы LINQ часто более понятны и читаемы по сравнению с традиционным подходом, что облегчает понимание и сопровождение кода.

3. **Безопасность на этапе компиляции:**
   - Поскольку LINQ поддерживает статическую типизацию, большинство ошибок обнаруживается на этапе компиляции, а не во время выполнения.

4. **Переиспользуемость:**
   - LINQ-запросы можно легко переиспользовать и модифицировать, что делает код более гибким.

Таким образом, LINQ — это мощный инструмент, который позволяет разработчикам эффективно работать с данными из различных источников, улучшая качество и производительность кода.

Чтобы использовать LINQ, типы данных, к которым вы хотите применять запросы, должны поддерживать определенные интерфейсы, которые позволяют выполнять операции над коллекциями данных. Основные интерфейсы, которые обеспечивают совместимость с LINQ, включают:

1. **`IEnumerable<T>`** и **`IEnumerable`**:
   - Это базовый интерфейс, который должен поддерживать тип данных для использования с LINQ к объектам (`LINQ to Objects`).
   - `IEnumerable<T>` определяет последовательность объектов, по которой можно выполнять итерации, что позволяет применять запросы LINQ.
   - Пример: массивы, списки (`List<T>`), коллекции и другие типы данных, реализующие `IEnumerable<T>`, поддерживают LINQ.

   ```csharp
   List<int> numbers = new List<int> { 1, 2, 3, 4, 5 };
   var evenNumbers = numbers.Where(n => n % 2 == 0);
   ```

2. **`IQueryable<T>`** и **`IQueryable`**:
   - Это интерфейс, который расширяет `IEnumerable<T>` и добавляет возможность работы с провайдерами запросов. Он используется в LINQ к базам данных (`LINQ to SQL`, `Entity Framework`) и позволяет выполнять отложенные запросы, которые переводятся в SQL-запросы.
   - `IQueryable<T>` позволяет запросам быть более эффективными при работе с базами данных, так как запросы оптимизируются и выполняются на стороне сервера.

   ```csharp
   using (var context = new MyDbContext())
   {
       IQueryable<Student> studentsQuery = context.Students.Where(s => s.Age > 18);
       List<Student> students = studentsQuery.ToList(); // Запрос выполняется здесь
   }
   ```

### Примеры типов и коллекций, которые поддерживают LINQ:

- **Массивы (`Array`)**: Реализуют `IEnumerable<T>`.
- **Коллекции (`List<T>`, `Dictionary<TKey, TValue>`)**: Реализуют `IEnumerable<T>`.
- **Коллекции данных, возвращаемые от базы данных с использованием ORM (например, `DbSet<T>` в Entity Framework)**: Реализуют `IQueryable<T>`.
- **Типы данных, поддерживающие XML (`XDocument`, `XElement`)**: Поддерживают LINQ to XML.

Таким образом, чтобы **тип данных мог использовать LINQ, он должен поддерживать хотя бы один из интерфейсов `IEnumerable<T>` или `IQueryable<T>`**, которые предоставляют методы для выполнения запросов и итерации по элементам коллекции.