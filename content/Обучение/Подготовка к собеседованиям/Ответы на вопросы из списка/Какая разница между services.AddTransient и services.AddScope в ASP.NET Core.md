---
уровень: "[[middle]]"
секция: платформа .NET
пройдено: 
теги: 
дата: 02-05-2024
время: 20:28
---
В ASP.NET Core, когда вы настраиваете зависимость в контейнере внедрения зависимостей (DI), вы можете выбрать один из трех жизненных циклов: `Transient`, `Scoped`, и `Singleton`. Вопрос касается различий между `AddTransient` и `AddScoped`. Вот их основные отличия:

### 1. **Жизненный Цикл**

- **`AddTransient`**:
  - **Жизненный цикл**: Создается новый экземпляр объекта каждый раз, когда он запрашивается.
  - **Когда использовать**: Подходит для легковесных, статeless (без состояния) объектов, которые не должны сохраняться между запросами. Примеры включают простые сервисы или утилиты.
  - **Пример использования**: Если у вас есть сервис, который выполняет какую-то обработку и не должен сохранять состояние между вызовами, вы можете зарегистрировать его как `Transient`.

  ```csharp
  services.AddTransient<IMyService, MyService>();
  ```

- **`AddScoped`**:
  - **Жизненный цикл**: Создается один экземпляр объекта на каждый запрос (веб-запрос или вызов из другого метода, если это допустимо). В рамках одного запроса будет использоваться один и тот же экземпляр.
  - **Когда использовать**: Подходит для объектов, которые имеют состояние и должны быть одинаковыми в течение одного запроса, но могут отличаться между запросами. Это также часто используется для работы с контекстами базы данных (например, `DbContext` в Entity Framework).
  - **Пример использования**: Если у вас есть сервис, который сохраняет состояние между вызовами в рамках одного запроса (например, логика бизнес-процессов, которая зависит от состояния запроса), вы можете зарегистрировать его как `Scoped`.

  ```csharp
  services.AddScoped<IMyService, MyService>();
  ```

### 2. **Примеры Жизненного Цикла**

- **`AddTransient`**:
  - При каждом вызове будет создан новый объект.
  - Если у вас есть класс, который не хранит данные между вызовами и может быть создан заново без проблем, используйте `Transient`.

  ```csharp
  public class MyService : IMyService
  {
      public MyService()
      {
          // Конструктор
      }
  }
  ```

- **`AddScoped`**:
  - Один экземпляр объекта будет создан на запрос и использован в течение всего этого запроса.
  - Полезно для сервисов, которые выполняют работу в рамках одного запроса и должны поддерживать состояние между вызовами.

  ```csharp
  public class MyService : IMyService
  {
      private readonly MyDbContext _context;

      public MyService(MyDbContext context)
      {
          _context = context;
      }

      // Методы для работы с _context
  }
  ```

### 3. **Сравнение с `Singleton`**

- **`Singleton`**:
  - Создается один экземпляр объекта на весь срок жизни приложения. Это подходит для объектов, которые не хранят состояние, или которые должны быть общими для всего приложения.
  - Пример использования:

  ```csharp
  services.AddSingleton<IMyService, MyService>();
  ```

### 4. **Сводка**

- **`Transient`**: Создает новый экземпляр каждый раз, когда он запрашивается. Используйте, если объект не имеет состояния и его создание не затратное.
- **`Scoped`**: Создает один экземпляр на каждый запрос (или в пределах области действия). Используйте для объектов, которые имеют состояние и которые должны быть едиными в рамках одного запроса.

Понимание разницы между этими жизненными циклами поможет вам правильно управлять ресурсами и производительностью вашего приложения, обеспечивая правильное поведение ваших зависимостей в зависимости от их предназначения и требований.