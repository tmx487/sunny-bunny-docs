---
уровень: "[[middle]]"
секция: общее
пройдено: 
теги: 
дата: 2024-05-02
время: 20:18
---
**Dependency Injection (DI)** — это паттерн проектирования, используемый для управления зависимостями между компонентами системы. Этот паттерн помогает создавать гибкие и легко поддерживаемые системы, снижая связность компонентов и улучшая их тестируемость.

### Основные концепции Dependency Injection

1. **Зависимости**:
   - В контексте DI, "зависимости" — это объекты, которые используются другими объектами. Например, если у вас есть класс `OrderService`, который использует класс `OrderRepository`, то `OrderRepository` является зависимостью `OrderService`.

2. **Инъекция зависимостей**:
   - Инъекция зависимостей — это процесс предоставления объектам необходимых зависимостей. Вместо того чтобы создавать зависимости внутри объекта, они предоставляются извне, обычно через конструктор, методы или свойства.

3. **Контейнер зависимостей**:
   - В .NET и других платформах, контейнер зависимостей (или DI контейнер) управляет созданием и жизненным циклом объектов и их зависимостями. Контейнер автоматически создает и инъектирует зависимости в объекты при необходимости.

### Почему использовать Dependency Injection?

1. **Снижение связности**:
   - DI помогает снизить связность между компонентами. Объекты больше не создают свои зависимости самостоятельно, а получают их из внешних источников. Это делает систему более гибкой и менее зависимой от конкретных реализаций.

2. **Упрощение тестирования**:
   - С помощью DI можно легко заменить реальные зависимости на моки или заглушки в тестах, что упрощает модульное тестирование. Вы можете тестировать компоненты изолированно, без необходимости создания сложной инфраструктуры.

3. **Упрощение замены реализаций**:
   - Вы можете легко заменять реализации зависимостей без изменения кода, который их использует. Это полезно для изменения поведения приложения или для внедрения новых реализаций.

4. **Управление жизненным циклом объектов**:
   - DI контейнер может управлять жизненным циклом объектов, обеспечивая создание и уничтожение объектов в нужный момент. Это помогает управлять ресурсами и обеспечивает правильное освобождение ресурсов.

### Примеры использования Dependency Injection

#### 1. **Конструкторная инъекция**

В этом методе зависимости передаются через конструктор класса.

```csharp
// Зависимость
public interface IOrderRepository
{
    void AddOrder(Order order);
}

// Реализация зависимости
public class SqlOrderRepository : IOrderRepository
{
    public void AddOrder(Order order) { /* Реализация */ }
}

// Класс, использующий зависимость
public class OrderService
{
    private readonly IOrderRepository _orderRepository;

    public OrderService(IOrderRepository orderRepository)
    {
        _orderRepository = orderRepository;
    }

    public void CreateOrder(Order order)
    {
        _orderRepository.AddOrder(order);
    }
}
```

#### 2. **Инъекция через свойства**

Зависимости передаются через свойства объекта.

```csharp
public class OrderService
{
    public IOrderRepository OrderRepository { get; set; }

    public void CreateOrder(Order order)
    {
        OrderRepository.AddOrder(order);
    }
}
```

#### 3. **Инъекция через методы**

Зависимости передаются через методы.

```csharp
public class OrderService
{
    public void CreateOrder(Order order, IOrderRepository orderRepository)
    {
        orderRepository.AddOrder(order);
    }
}
```

### Использование Dependency Injection в .NET

В .NET Core и .NET 5+ встроен контейнер DI, который упрощает использование DI. В `Startup.cs` (или в `Program.cs` в .NET 6+) вы регистрируете зависимости, и они автоматически инъектируются в ваши классы.

#### Регистрация зависимостей

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddScoped<IOrderRepository, SqlOrderRepository>();
    services.AddTransient<OrderService>();
}
```

#### Использование зависимостей

В контроллере или другом классе, зависимости будут автоматически инъектированы через конструктор.

```csharp
public class OrdersController : ControllerBase
{
    private readonly OrderService _orderService;

    public OrdersController(OrderService orderService)
    {
        _orderService = orderService;
    }

    public IActionResult CreateOrder(Order order)
    {
        _orderService.CreateOrder(order);
        return Ok();
    }
}
```

### Заключение

Dependency Injection помогает создавать гибкие, поддерживаемые и тестируемые системы, управляя зависимостями между компонентами. Использование DI упрощает управление жизненным циклом объектов, снижает связность и улучшает тестируемость, что делает код более устойчивым к изменениям и более легким в поддержке.

> DI позволяет избежать жесткой привязки классов к конкретным реализациям зависимостей. Это повышает модульность, облегчает тестирование, так как зависимости можно легко заменять на моки или стабы, и улучшает читаемость и поддержку кода.