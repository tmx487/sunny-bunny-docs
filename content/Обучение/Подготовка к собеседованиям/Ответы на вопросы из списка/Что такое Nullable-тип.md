---
уровень: "[[junior]]"
секция: типы, структуры и коллекции данных
пройдено: 
теги: 
дата: 2024-05-02
время: 19:57
---

### Так говорил ChatGPT

В C# `Nullable`-типы позволяют вам присваивать переменным типов значений (`value types`) специальное значение `null`. Это особенно полезно, когда необходимо обозначить, что значение отсутствует или неизвестно, что обычно делается в контексте ссылочных типов (`reference types`).

### Основные характеристики `Nullable`-типов:

1. **Типы значений**:
   - В C#, типы значений, такие как `int`, `float`, `bool`, не могут принимать значение `null` по умолчанию. Однако, используя `Nullable`-тип, можно сделать так, чтобы переменная этих типов могла быть `null`.

2. **Объявление `Nullable`-типа**:
   - В C# существует два способа объявить `Nullable`-тип:
     - Использование конструкции `Nullable<T>`, где `T` — это тип значения.
     - Использование синтаксиса с вопросительным знаком `?` после типа значения.
     
     Например:
     ```csharp
     Nullable<int> nullableInt = null;
     int? nullableIntShortcut = null;
     ```

3. **Свойства `Nullable`-типов**:
   - `HasValue`: Возвращает `true`, если переменная имеет значение, и `false`, если она равна `null`.
   - `Value`: Возвращает значение переменной, если она не равна `null`. Если же переменная равна `null`, то при попытке доступа к этому свойству будет выброшено исключение `InvalidOperationException`.

     Пример:
     ```csharp
     int? number = 5;

     if (number.HasValue)
     {
         Console.WriteLine($"Value: {number.Value}");
     }
     else
     {
         Console.WriteLine("No value");
     }
     ```

4. **Сравнение с `null` и присваивание**:
   - `Nullable`-типы можно сравнивать с `null`, чтобы проверить, имеет ли переменная значение.
   - Также можно использовать оператор `??` для присваивания значения по умолчанию, если переменная равна `null`.

     Пример:
     ```csharp
     int? number = null;
     int valueOrDefault = number ?? 0; // Если number равен null, то присваивается 0
     ```

### Когда использовать `Nullable`-типы?

- Когда вы работаете с типами значений, но хотите иметь возможность указать, что переменная может не иметь значения.
- Когда разрабатываете API или методы, которые могут возвращать значение или указывать на его отсутствие (например, результат поиска, который может не найти подходящий элемент).
- В случаях, когда работаете с базами данных, где значения могут быть неопределенными (`NULL` в SQL).

### Пример использования `Nullable`-типа:

```csharp
int? possibleNumber = null;

if (possibleNumber.HasValue)
{
    Console.WriteLine($"The number is {possibleNumber.Value}");
}
else
{
    Console.WriteLine("The number is null");
}

int safeNumber = possibleNumber ?? -1; // Используем значение по умолчанию, если possibleNumber равно null
Console.WriteLine(safeNumber); // Выведет -1
```

### Особенности `Nullable`-типов:

- `Nullable`-типы могут упрощать работу с неопределенными значениями, но их следует использовать осторожно, чтобы избежать ошибок, связанных с возможными `null` значениями (например, `NullReferenceException`).
- В C# 8.0 была добавлена концепция "nullable reference types", которая позволяет применить аналогичный подход к ссылочным типам, делая их nullable и non-nullable, что помогает избежать распространенных ошибок, связанных с `null`.

#### System.Nullable(T)

==дописать инфу про null-совместимые значимые типы==

- В качестве параметра `T` типа `Nullable` могут использоваться **только** структуры — ведь переменные ссылочного типа и так могут принимать значение null
- Можно выполнять преобразования, а также приведение null-совместимых экземпляров к другим типам. Язык C# поддерживает возможность применения операторов к экземплярам null-совместимых значимых типов
- Для операций с экземплярами null-совместимых типов генерируется **большой объем кода**,  вследствие чего операции с null-совместимыми типами выполняются **медленнее** аналогичных операций с другими типами


**Оператор объединения null-совместимых значений** (англ. null-coalescing operator) обозначается как `??` и работает с двумя операндами. Если левый операнд **не равен null**, оператор возвращает его значение. В противном случае возвращается значение правого операнда. Оператор объединения null-совместимых значений удобен при задании предлагаемого по умолчанию значения переменной.

> Основным преимуществом этого оператора является поддержка как ссылочных, так и null-совместимых значимых типов

```csharp
private static void NullCoalescingOperator()
	{
		Int32? b = null;
		
		// Приведенная далее инструкция эквивалентна следующей:
		// x = (b.HasValue) ? b.Value : 123
		
		Int32 x = b ?? 123;
		Console.WriteLine(x); // "123"
		
		// Приведенная далее в инструкции строка эквивалентна следующему коду:
		// String temp = GetFilename();
		// filename = (temp != null) ? temp : "Untitled";
		
		String filename = GetFilename() ?? "Untitled";
	}
```

boxing/unboxing of nullable-types

```csharp
// BOXING

// После упаковки Nullable<T> возвращается null или упакованный тип T
Int32? n = null;
Object o = n; // o равно null
Console.WriteLine("o is null={0}", o == null); // "True"

n = 5;
o = n; // o ссылается на упакованный тип Int32
Console.WriteLine("o's type={0}", o.GetType()); // "System.Int32"

// UNBOXING

// Создание упакованного типа Int32
Object o = 5;

// Распаковка этого типа в Nullable<Int32> и в Int32
Int32? a = (Int32?) o; // a = 5
Int32 b = (Int32) o; // b = 5

// Создание ссылки, инициализированной значением null
o = null;

// "Распаковка" ее в Nullable<Int32> и в Int32
a = (Int32?) o; // a = null
b = (Int32) o; // NullReferenceException

```