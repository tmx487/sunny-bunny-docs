Для создания и отката миграций в контейнере приложения с использованием `dotnet ef` нужно выполнить следующие шаги:

### Шаги для работы с `dotnet ef` в контейнере

#### 1. **Убедитесь, что `dotnet-ef` установлен в контейнере**

Добавьте в `Dockerfile` следующую строку, чтобы установить `dotnet-ef`:

```dockerfile
RUN dotnet tool install --global dotnet-ef
ENV PATH="$PATH:/root/.dotnet/tools"
```

Проверка, установлен ли `dotnet ef` в контейнере

```bash
dotnet ef --version
```

Если  `dotnet ef` , то выведет версию  `dotnet ef` (например см. ниже)

```bash
8.0.8
```
##### **Проверка через глобальные инструменты:**

```bash
dotnet tool list -g
```

Это покажет список всех глобально установленных инструментов. Если `dotnet ef` установлен, он будет в списке.
#### 2. **Создайте `volume` для синхронизации кода**

Чтобы контейнер имел доступ к коду и миграциям из вашей локальной машины, используйте volume для монтирования.

### Пример `docker-compose.override.yml` для работы с миграциями:

```yaml
version: '3.9'
services:
  contacts.api:
    volumes:
      - .:/app
    working_dir: /app
    environment:
      - DOTNET_ENVIRONMENT=Development
```

### Шаги для выполнения команд `dotnet ef` внутри контейнера

#### 3. **Создание новой миграции**

1. Подключитесь к контейнеру:
    
    ```bash
    docker exec -it contacts.api bash
    ```
    
2. Выполните команду для создания миграции:
    
    ```bash
    dotnet ef migrations add <MigrationName> --startup-project Contacts.API --project Contacts.API
    ```
    
    Параметры:
    
    - `--startup-project` — указывает проект, который запускает приложение.
    - `--project` — проект с DbContext.

#### 4. **Применение миграции**

Выполните команду для обновления базы данных:

```bash
dotnet ef database update --startup-project Contacts.API --project Contacts.API
```

#### 5. **Откат миграции**

Чтобы откатить к предыдущей миграции, выполните:

```bash
dotnet ef database update <PreviousMigrationName> --startup-project Contacts.API --project Contacts.API
```

#### 6. **Выполнение миграций при запуске контейнера (опционально)**

Если хотите автоматизировать применение миграций при запуске контейнера, добавьте в `Program.cs`:

```csharp
using (var scope = app.Services.CreateScope())
{
    var dbContext = scope.ServiceProvider.GetRequiredService<ApplicationDbContext>();
    dbContext.Database.Migrate();
}
```

Теперь вы сможете управлять миграциями даже в контейнеризованной среде.