–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ .NET**, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è `IMemoryCache`, Redis –∏–ª–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, —Ç–µ–±–µ –Ω—É–∂–Ω–æ:

- –°–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π **–∫—ç—à-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–∞—Ä—å).
    
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏** (expiration).
    
- –û–±–µ—Å–ø–µ—á–∏—Ç—å **–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**.
    

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–µ–π—à–µ–≥–æ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ in-memory –∫—ç—à–∞

```csharp
public class SimpleMemoryCache<TKey, TValue>
{
    private class CacheItem
    {
        public TValue Value { get; set; }
        public DateTime Expiration { get; set; }
    }

    private readonly Dictionary<TKey, CacheItem> _cache = new();
    private readonly TimeSpan _defaultTtl;
    private readonly object _lock = new();

    public SimpleMemoryCache(TimeSpan defaultTtl)
    {
        _defaultTtl = defaultTtl;
    }

    public void Set(TKey key, TValue value, TimeSpan? ttl = null)
    {
        lock (_lock)
        {
            _cache[key] = new CacheItem
            {
                Value = value,
                Expiration = DateTime.UtcNow + (ttl ?? _defaultTtl)
            };
        }
    }

    public bool TryGet(TKey key, out TValue value)
    {
        lock (_lock)
        {
            if (_cache.TryGetValue(key, out var item))
            {
                if (item.Expiration > DateTime.UtcNow)
                {
                    value = item.Value;
                    return true;
                }

                // item expired
                _cache.Remove(key);
            }

            value = default!;
            return false;
        }
    }

    public void Remove(TKey key)
    {
        lock (_lock)
        {
            _cache.Remove(key);
        }
    }
}
```

---

## üîß –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```csharp
var cache = new SimpleMemoryCache<long, Thing>(TimeSpan.FromMinutes(5));

cache.Set(1, new Thing { ID = 1, Name = "Test" });

if (cache.TryGet(1, out var thing))
{
    Console.WriteLine($"Thing from cache: {thing.Name}");
}
```

---

## üîí –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `lock`, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `Dictionary<TKey, CacheItem>`.
    
- –î–ª—è –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ConcurrentDictionary`, –Ω–æ —Å –Ω–∏–º —Å–ª–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `expiration`.
    

---

## üì¶ –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:

1. **–§–æ–Ω–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π (Garbage Collector)**.
    
2. TTL per item (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ).
    
3. Async-–≤–µ—Ä—Å–∏—è (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).
    
4. –°—á—ë—Ç—á–∏–∫–∏/–ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (optional).
    

---

–•–æ—á–µ—à—å, —è –¥–æ–±–∞–≤–ª—é `background cleaner` –∏–ª–∏ –ø–æ–∫–∞–∂—É, –∫–∞–∫ –≤—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–æ—Ç –∫—ç—à –≤ `ThingService`?