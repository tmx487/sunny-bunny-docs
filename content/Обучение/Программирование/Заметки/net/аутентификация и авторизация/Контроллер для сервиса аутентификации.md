В контроллере сервиса аутентификации должны быть эндпоинты, выполняющие ключевые действия, связанные с входом, выходом, обновлением токенов и управлением пользователями.

### **Основные действия контроллера**

#### 1️⃣ **Регистрация пользователя (`POST /register`)**

- Принимает данные нового пользователя (email, пароль и т. д.).
- Создаёт пользователя в базе данных.
- Может сразу возвращать `access` и `refresh` токены или требовать подтверждения email.

#### 2️⃣ **Аутентификация (`POST /login`)**

- Принимает email и пароль.
- Проверяет корректность данных.
- Генерирует и возвращает `access` и `refresh` токены.

#### 3️⃣ **Обновление токена (`POST /refresh-token`)**

- Принимает `refresh` токен.
- Проверяет его валидность и срок действия.
- Если токен валиден, создаёт новый `access` токен.

#### 4️⃣ **Выход (`POST /logout`)**

- Принимает `refresh` токен.
- Удаляет или помечает его как недействительный.
- Можно также очищать куки или сессии пользователя.

#### 5️⃣ **Подтверждение email (`GET /confirm-email`)**

- Принимает токен подтверждения из email.
- Активирует учётную запись пользователя.

#### **6️⃣ Восстановление пароля**

- **Запрос сброса (`POST /forgot-password`)** – отправляет пользователю ссылку для сброса пароля.
- **Сброс пароля (`POST /reset-password`)** – принимает новый пароль и применяет его.

#### 7️⃣ **Получение информации о пользователе (`GET /me`)**

- Принимает `access` токен и возвращает данные текущего пользователя.

---

### **Дополнительно (по необходимости)**

✅ **Роли и разрешения** (например, `POST /assign-role`)  
✅ **Двухфакторная аутентификация (2FA)**  
✅ **Ограничение количества активных сессий**

Этот сервис должен также работать с **Microsoft Identity**, хранить пользователей в **PostgreSQL**, кэшировать сессии в **Redis** и использовать **RabbitMQ** для отправки уведомлений (например, писем о подтверждении регистрации).

### **Spec**

```yaml
openapi: 3.0.3
info:
  title: Authentication Service API
  description: API для аутентификации и управления пользователями
  version: 1.0.0

paths:
  /register:
    post:
      summary: Регистрация нового пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
              required: [email, password]
      responses:
        '201':
          description: Успешная регистрация
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Ошибка валидации

  /login:
    post:
      summary: Аутентификация пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
              required: [email, password]
      responses:
        '200':
          description: Успешная аутентификация
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  refresh_token:
                    type: string
        '401':
          description: Неверные учетные данные

  /refresh-token:
    post:
      summary: Обновление access-токена
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
              required: [refresh_token]
      responses:
        '200':
          description: Успешное обновление токена
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
        '401':
          description: Недействительный refresh-токен

  /logout:
    post:
      summary: Выход из системы
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
              required: [refresh_token]
      responses:
        '200':
          description: Успешный выход
        '400':
          description: Ошибка запроса

  /confirm-email:
    get:
      summary: Подтверждение email
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Email подтвержден
        '400':
          description: Недействительный или просроченный токен

  /forgot-password:
    post:
      summary: Запрос на восстановление пароля
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
              required: [email]
      responses:
        '200':
          description: Инструкция по восстановлению пароля отправлена
        '400':
          description: Ошибка валидации

  /reset-password:
    post:
      summary: Сброс пароля
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                new_password:
                  type: string
                  format: password
              required: [token, new_password]
      responses:
        '200':
          description: Пароль успешно сброшен
        '400':
          description: Ошибка валидации

  /me:
    get:
      summary: Получение информации о текущем пользователе
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Информация о пользователе
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  email:
                    type: string
        '401':
          description: Неавторизованный доступ

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

```