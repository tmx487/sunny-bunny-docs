# Index

- [[#–û–±—â–µ–µ]]
	- [[#üìå **1. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Policy –≤ .NET**]]
	- [[#üìå **2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏**]]
	- [[#üìå **3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫**]]
	- [[#üìå **4. –ü–æ–ª–∏—Ç–∏–∫–∏ —Å `IAuthorizationRequirement`**]]
	- [[#üéØ **–í—ã–≤–æ–¥**]]
- [[#–ö–∞–∫ .NET –∏–∑–≤–ª–µ–∫–∞–µ—Ç claims –∏–∑ –∑–∞–ø—Ä–æ—Å–∞?]]
	- [[#üìå **–ì–¥–µ –∏—Å–∫–∞—Ç—å –∫–ª–µ–π–º—ã –≤ –∫–æ–¥–µ?**]]
	- [[#üìå **–ö–∞–∫–æ–π –∫–ª–µ–π–º –∏—Å–∫–∞—Ç—å?**]]
	- [[#üéØ **–í—ã–≤–æ–¥**]]
## –û–±—â–µ–µ

–í **ASP.NET Core** –ø–æ–ª–∏—Ç–∏–∫–∏ (**Policy**) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** –∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–¥–∞–≤–∞—Ç—å –≥–∏–±–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ **–∫–ª–µ–π–º–æ–≤ (Claims)**, **—Ä–æ–ª–µ–π (Roles)** –∏–ª–∏ **–¥—Ä—É–≥–∏—Ö —É—Å–ª–æ–≤–∏–π**.

–ü–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–∫–∞–∑–∞—Ç—å:

> ¬´–î–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–º—É —Ä–µ—Å—É—Ä—Å—É —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –Ω—É–∂–Ω—ã–π –∫–ª–µ–π–º –∏–ª–∏ –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É —É—Å–ª–æ–≤–∏—é.¬ª

---

## üìå **1. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Policy –≤ .NET**

### **1.1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ `Program.cs`**

```csharp
builder.Services.AddAuthorization(options =>
{
    options.AddPolicy("RequireAdminRole", policy =>
        policy.RequireRole("Admin")); // –ü–æ–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Ä–æ–ª—å "Admin"

    options.AddPolicy("Age18OrOlder", policy =>
        policy.RequireClaim("Age", "18", "19", "20", "21")); // –ü–æ–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –∫–ª–µ–π–º "Age" >= 18
});
```

üîπ –ó–¥–µ—Å—å –º—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–≤–µ –ø–æ–ª–∏—Ç–∏–∫–∏:

1. **`RequireAdminRole`** ‚Äì —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å —Ä–æ–ª—å—é `"Admin"`.
2. **`Age18OrOlder`** ‚Äì —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –≤ –∫–ª–µ–π–º–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—ã–ª–æ –ø–æ–ª–µ `"Age"` —Å –¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.

---

## üìå **2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏**

### **2.1. –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö**

–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ, –¥–æ–±–∞–≤–ª—è–µ–º `[Authorize(Policy = "...")]`:

```csharp
[Authorize(Policy = "RequireAdminRole")]
[HttpGet("admin")]
public IActionResult GetAdminData()
{
    return Ok("This is admin data");
}
```

üí° –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é **Admin** —Å–º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É.

---

### **2.2. –í –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º API**

```csharp
app.MapGet("/admin", () => "Admin only data")
    .RequireAuthorization("RequireAdminRole");
```

–ó–¥–µ—Å—å –ø–æ–ª–∏—Ç–∏–∫–∞ `"RequireAdminRole"` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `MapGet()`.

---

## üìå **3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫**

–ü–æ–ª–∏—Ç–∏–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω–µ–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä—è—Ç—å **–≤–æ–∑—Ä–∞—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —á–∏—Å–ª–∞, –∞ –Ω–µ —Å—Ç—Ä–æ–∫**:

```csharp
builder.Services.AddAuthorization(options =>
{
    options.AddPolicy("AdultOnly", policy =>
        policy.RequireAssertion(context =>
        {
            var ageClaim = context.User.FindFirst("Age");
            if (ageClaim == null) return false;
            return int.TryParse(ageClaim.Value, out var age) && age >= 18;
        }));
});
```

üîπ –ó–¥–µ—Å—å:

- –ú—ã –∏—â–µ–º –∫–ª–µ–π–º `"Age"`, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, **–±–æ–ª—å—à–µ –ª–∏ 18**.
- –ï—Å–ª–∏ –Ω–µ—Ç –∫–ª–µ–π–º–∞ `"Age"` –∏–ª–∏ –æ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ‚Üí –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.

---

## üìå **4. –ü–æ–ª–∏—Ç–∏–∫–∏ —Å `IAuthorizationRequirement`**

–î–ª—è **—Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª** —Å–æ–∑–¥–∞—é—Ç—Å—è **–∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏**.

### **4.1. –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**

```csharp
public class MinimumAgeRequirement : IAuthorizationRequirement
{
    public int MinimumAge { get; }

    public MinimumAgeRequirement(int minimumAge)
    {
        MinimumAge = minimumAge;
    }
}
```

### **4.2. –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**

```csharp
public class MinimumAgeHandler : AuthorizationHandler<MinimumAgeRequirement>
{
    protected override Task HandleRequirementAsync(
        AuthorizationHandlerContext context, 
        MinimumAgeRequirement requirement)
    {
        var ageClaim = context.User.FindFirst(c => c.Type == "Age");
        if (ageClaim != null && int.TryParse(ageClaim.Value, out var age) && age >= requirement.MinimumAge)
        {
            context.Succeed(requirement); // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ ‚úÖ
        }

        return Task.CompletedTask;
    }
}
```

### **4.3. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤ `Program.cs`**

```csharp
builder.Services.AddAuthorization(options =>
{
    options.AddPolicy("Age21OrOlder", policy =>
        policy.Requirements.Add(new MinimumAgeRequirement(21)));
});

builder.Services.AddSingleton<IAuthorizationHandler, MinimumAgeHandler>();
```

–¢–µ–ø–µ—Ä—å –ø–æ–ª–∏—Ç–∏–∫–∞ `"Age21OrOlder"` **—Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**.

### **4.4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**

```csharp
[Authorize(Policy = "Age21OrOlder")]
public IActionResult RestrictedContent()
{
    return Ok("Welcome! You're 21 or older.");
}
```

‚úÖ –¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–æ–∑—Ä–∞—Å—Ç ‚â• 21**.

---

## üéØ **–í—ã–≤–æ–¥**

- **–ü–æ–ª–∏—Ç–∏–∫–∏ (Policy)** –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- –û–Ω–∏ –º–æ–≥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å **—Ä–æ–ª–∏, –∫–ª–µ–π–º—ã, –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π** –∏ –¥—Ä—É–≥–∏–µ —É—Å–ª–æ–≤–∏—è.
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏** (`RequireRole()`, `RequireClaim()`) –∏–ª–∏ **—Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** —á–µ—Ä–µ–∑ `IAuthorizationRequirement`.

–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º ‚Äî —Å–ø—Ä–∞—à–∏–≤–∞–π! üöÄ

## –ö–∞–∫ .NET –∏–∑–≤–ª–µ–∫–∞–µ—Ç claims –∏–∑ –∑–∞–ø—Ä–æ—Å–∞?

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–∑–∞–ø—Ä–æ—Å —Å JWT-—Ç–æ–∫–µ–Ω–æ–º**, ASP.NET Core **–∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫–ª–µ–π–º—ã –∏–∑ —Ç–æ–∫–µ–Ω–∞** –∏ –¥–µ–ª–∞–µ—Ç –∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≤ `HttpContext.User`.

–≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤:

1. **–¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞**
    
    ```
    Authorization: Bearer <your_token>
    ```
    
2. **JWT Middleware –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞ (`AddAuthentication` –∏ `JwtBearer`)**
    
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç **–ø–æ–¥–ø–∏—Å—å** —Ç–æ–∫–µ–Ω–∞
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç **—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è**
    - –ò–∑–≤–ª–µ–∫–∞–µ—Ç **payload** (–≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è claims)
    - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç claims –≤ –æ–±—ä–µ–∫—Ç `ClaimsPrincipal`
3. **Claims –ø–æ–ø–∞–¥–∞—é—Ç –≤ `HttpContext.User`**, –æ—Ç–∫—É–¥–∞ –∏—Ö –º–æ–∂–Ω–æ –¥–æ—Å—Ç–∞—Ç—å.
    

---

## üìå **–ì–¥–µ –∏—Å–∫–∞—Ç—å –∫–ª–µ–π–º—ã –≤ –∫–æ–¥–µ?**

### **1Ô∏è‚É£ –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ —á–µ—Ä–µ–∑ `User.Claims`**

```csharp
[Authorize]
[HttpGet("user-info")]
public IActionResult GetUserInfo()
{
    var userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value; // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    var email = User.FindFirst(ClaimTypes.Email)?.Value; // Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    var roles = User.Claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).ToList(); // –í—Å–µ —Ä–æ–ª–∏

    return Ok(new { userId, email, roles });
}
```

üîπ –ó–¥–µ—Å—å:

- `FindFirst(ClaimTypes.NameIdentifier)` –∏—â–µ—Ç **–ø–µ—Ä–≤—ã–π** –∫–ª–µ–π–º —Å —Ç–∏–ø–æ–º **NameIdentifier** (–æ–±—ã—á–Ω–æ —ç—Ç–æ `sub` –≤ JWT).
- `FindFirst(ClaimTypes.Email)` –∏—â–µ—Ç email.
- `Where(c => c.Type == ClaimTypes.Role)` —Å–æ–±–∏—Ä–∞–µ—Ç **–≤—Å–µ** —Ä–æ–ª–∏.

---

### **2Ô∏è‚É£ –í –∫–∞—Å—Ç–æ–º–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ —á–µ—Ä–µ–∑ `AuthorizationHandlerContext`**

–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏**, –∫–ª–µ–π–º—ã –∏—â—É—Ç—Å—è —Ç–∞–∫:

```csharp
public class MinimumAgeHandler : AuthorizationHandler<MinimumAgeRequirement>
{
    protected override Task HandleRequirementAsync(
        AuthorizationHandlerContext context, MinimumAgeRequirement requirement)
    {
        var ageClaim = context.User.FindFirst(c => c.Type == "Age");
        if (ageClaim != null && int.TryParse(ageClaim.Value, out var age) && age >= requirement.MinimumAge)
        {
            context.Succeed(requirement); // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
        }

        return Task.CompletedTask;
    }
}
```

üîπ –ó–¥–µ—Å—å:

- `context.User.FindFirst("Age")` –∏—â–µ—Ç **–∫–ª–µ–π–º —Å –∫–ª—é—á–æ–º `"Age"`**.
- –ï—Å–ª–∏ –æ–Ω –Ω–∞–π–¥–µ–Ω –∏ –≤–æ–∑—Ä–∞—Å—Ç **>= –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ**, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞.

---

### **3Ô∏è‚É£ –í middleware (`HttpContext.User`)**

–ö–ª–µ–π–º—ã –º–æ–∂–Ω–æ –¥–æ—Å—Ç–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –∏–∑ `HttpContext`:

```csharp
app.Use(async (context, next) =>
{
    var userId = context.User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
    Console.WriteLine($"Current User ID: {userId}");
    await next();
});
```

üîπ –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å **–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å** –∏–ª–∏ **–º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üìå **–ö–∞–∫–æ–π –∫–ª–µ–π–º –∏—Å–∫–∞—Ç—å?**

–í JWT —Ç–æ–∫–µ–Ω–µ –µ—Å—Ç—å **—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∫–ª–µ–π–º–æ–≤**, –≤–æ—Ç –ø—Ä–∏–º–µ—Ä—ã:

|Claim|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|`sub`|ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—ã—á–Ω–æ `ClaimTypes.NameIdentifier`)|
|`email`|Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`ClaimTypes.Email`)|
|`role`|–†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`ClaimTypes.Role`)|
|`iat`|–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞|
|`exp`|–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è|

### **–ü—Ä–∏–º–µ—Ä JWT-—Ç–æ–∫–µ–Ω–∞ (payload)**

```json
{
  "sub": "12345",
  "email": "user@example.com",
  "role": ["Admin", "User"],
  "iat": 1708540800,
  "exp": 1708544400
}
```

üîπ –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç `"sub": "12345"`, —Ç–æ:

```csharp
User.FindFirst(ClaimTypes.NameIdentifier)?.Value; // "12345"
```

---

## üéØ **–í—ã–≤–æ–¥**

- **ASP.NET Core –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫–ª–µ–π–º—ã** –∏–∑ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —á–µ—Ä–µ–∑ `JwtBearer`.
- **–í—Å–µ –∫–ª–µ–π–º—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ `HttpContext.User.Claims`**.
- –ú–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑:
    - `User.FindFirst(ClaimTypes.NameIdentifier)`
    - `context.User.FindFirst("Age")`
    - `User.Claims.Where(c => c.Type == ClaimTypes.Role)`

–ï—Å–ª–∏ —É —Ç–µ–±—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–∏—Å–∫–æ–º –∫–ª–µ–π–º–∞, –ø—Ä–æ–≤–µ—Ä—å:

1. –ï—Å—Ç—å –ª–∏ –Ω—É–∂–Ω—ã–π –∫–ª–µ–π–º –≤ —Ç–æ–∫–µ–Ω–µ (–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ [jwt.io](https://jwt.io/)).
2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ç—ã —É–∫–∞–∑—ã–≤–∞–µ—à—å –µ–≥–æ **—Ç–∏–ø** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ClaimTypes.Email` –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ `"email"`).
3. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω `JwtBearerOptions`.

### –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ–± –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ –ø–æ–ª–∏—Ç–∏–∫

–°—Ç—Ä–æ–∫–∞:

```csharp
options.AddPolicy("OwnerOrSupervisor", policy => policy.RequireRole("Owner", "Supervisor"));
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫ –º–µ—Ç–æ–¥–∞–º –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ, –ø–æ–º–µ—á–µ–Ω–Ω—ã–º –∫–∞–∫ `[Authorize(Policy = "OwnerOrSupervisor")]`, —Å–º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∏–∑ —ç—Ç–∏—Ö —Ä–æ–ª–µ–π** ‚Äî **`Owner`** –∏–ª–∏ **`Supervisor`**.

–¢.–µ., –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Ä–æ–ª—å **`Owner`**, –ª–∏–±–æ **`Supervisor`**, –æ–Ω —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–∏–º –º–µ—Ç–æ–¥–∞–º.

### –ü–æ—è—Å–Ω–µ–Ω–∏–µ:

- –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ, **`RequireRole("Owner", "Supervisor")`** –∑–∞–¥–∞—ë—Ç –ø–æ–ª–∏—Ç–∏–∫—É, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–∏–±–æ **`Owner`**, –ª–∏–±–æ **`Supervisor`**.
- –≠—Ç–æ **–ª–æ–≥–∏—á–µ—Å–∫–æ–µ "–ò–õ–ò"**: –ª–∏–±–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Ä–æ–ª—å **`Owner`**, –ª–∏–±–æ **`Supervisor`**, –∏ –¥–ª—è —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–π —Ä–æ–ª–∏.

–ï—Å–ª–∏ –±—ã –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ **`RequireRole("Owner", "Supervisor")`** —Å **`AND`**, —Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–ª–æ –±—ã, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å **–æ–±–µ —Ä–æ–ª–∏** ‚Äî –∏ **`Owner`**, –∏ **`Supervisor`**. –û–¥–Ω–∞–∫–æ **`RequireRole`** —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç –∫–∞–∫ **`OR`**, —Ç–æ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–¥–Ω—É –∏–∑ —ç—Ç–∏—Ö —Ä–æ–ª–µ–π.

### –ü—Ä–∏–º–µ—Ä:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é **`Owner`** –∏–ª–∏ **`Supervisor`** —Å–º–æ–∂–µ—Ç –ø—Ä–æ–π—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–µ—Ç–æ–¥—É.
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –æ–±–µ–∏–º–∏ —Ä–æ–ª—è–º–∏ **`Owner`** –∏ **`Supervisor`** —Ç–∞–∫–∂–µ —Å–º–æ–∂–µ—Ç –ø—Ä–æ–π—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é.

–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã–ª –∏–º–µ—Ç—å **–æ–±–µ —Ä–æ–ª–∏** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π **`RequireRole`** –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑:

```csharp
options.AddPolicy("OwnerAndSupervisor", policy =>
    policy.RequireRole("Owner").RequireRole("Supervisor"));
```

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –±—É–¥–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏ **`Owner`**, –∏ **`Supervisor`**.