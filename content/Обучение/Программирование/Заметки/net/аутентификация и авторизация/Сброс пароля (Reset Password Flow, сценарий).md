–ü—Ä–∏ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ —É–¥–æ–±–Ω—ã–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í–æ—Ç –æ–±—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

---

### **üîπ 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è**

- –í–≤–æ–¥–∏—Ç email –≤ —Ñ–æ—Ä–º–µ "–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?"
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```http
POST /api/auth/forgot-password
Content-Type: application/json

{
  "email": "user@example.com"
}
```

---

### **üîπ 2. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç email –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–æ**

- –ï—Å–ª–∏ email —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω** (–æ–±—ã—á–Ω–æ JWT –∏–ª–∏ GUID)
- –¢–æ–∫–µ–Ω –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ URL –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ø–æ—á—Ç—É
- –≠—Ç–æ—Ç URL –≤–µ–¥–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è

üìß **–ü—Ä–∏–º–µ—Ä –ø–∏—Å—å–º–∞ (HTML + —Ç–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è):**

#### `reset_password_template.html`

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; }
        .container { width: 100%; max-width: 600px; margin: 20px auto; background-color: #fff; padding: 20px; border-radius: 8px; text-align: center; }
        .button { display: inline-block; background-color: #ff5a5f; color: white; text-decoration: none; padding: 12px 20px; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h2>
        <p>–í—ã –∑–∞–ø—Ä–æ—Å–∏–ª–∏ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</p>
        <a href="{{reset_link}}" class="button">–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</a>
        <p>–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫—É:</p>
        <p>{{reset_link}}</p>
        <p>–ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ —Å–±—Ä–æ—Å, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ —ç—Ç–æ –ø–∏—Å—å–º–æ.</p>
    </div>
</body>
</html>
```

#### `reset_password_template.txt`

```
–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è

–í—ã –∑–∞–ø—Ä–æ—Å–∏–ª–∏ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:

{{reset_link}}

–ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ —Å–±—Ä–æ—Å, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ —ç—Ç–æ –ø–∏—Å—å–º–æ.
```

---

### **üîπ 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ**

- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
- –¢–æ–∫–µ–Ω –∏–∑ URL –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤–º–µ—Å—Ç–µ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º

```http
POST /api/auth/reset-password
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR...",
  "email": "user@example.com",
  "newPassword": "NewSecureP@ssword123",
  "confirmPassword": "NewSecureP@ssword123"
}
```

---

### **üîπ 4. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –º–µ–Ω—è–µ—Ç –ø–∞—Ä–æ–ª—å**

- –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç email –∏–∑ —Ç–æ–∫–µ–Ω–∞ —Å email –≤ –∑–∞–ø—Ä–æ—Å–µ
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –≤ –ë–î
- –£–¥–∞–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω (–µ—Å–ª–∏ –æ–Ω —Ö—Ä–∞–Ω–∏–ª—Å—è –≤ –ë–î)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **—É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```json
{
  "message": "–í–∞—à –ø–∞—Ä–æ–ª—å –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω."
}
```

---

### **üîπ 5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º**

–ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –∏ –≤—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É.

---

### **üìå –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

‚úîÔ∏è **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞** (–æ–±—ã—á–Ω–æ 15-60 –º–∏–Ω—É—Ç)  
‚úîÔ∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ –∑–∞–ø—Ä–æ—Å–æ–≤** (Rate Limiting)  
‚úîÔ∏è **–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π JWT –∏–ª–∏ GUID**  
‚úîÔ∏è **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º**  
‚úîÔ∏è **–í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

### **üìå –ò—Ç–æ–≥**

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email** ‚Üí —Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω
- **–ü–∏—Å—å–º–æ —Å–æ —Å—Å—ã–ª–∫–æ–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ email**
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å**
- **–°–µ—Ä–≤–µ—Ä –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞—Ä–æ–ª—å**
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º**

üöÄ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å —ç—Ç–æ —É–¥–æ–±–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å.


## ‚ö°**–í–∞–∂–Ω–æ**

–°–∞–º –ø–æ —Å–µ–±–µ `Reset Password` **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** ‚Äì –æ–Ω –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç **–∫–∞–∫ –≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å** –ø–æ—Å–ª–µ `Forgot Password`.

### **üîπ –ü–æ—á–µ–º—É?**

–ß—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è (`Reset Password`), —Ç—Ä–µ–±—É–µ—Ç—Å—è **—Ç–æ–∫–µ–Ω**, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ "–ó–∞–±—ã–ª –ø–∞—Ä–æ–ª—å" (`Forgot Password`).

---

## **üîπ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è?**

**1Ô∏è‚É£ (Forgot Password)** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å.  
**2Ô∏è‚É£ –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω** –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ email.  
**3Ô∏è‚É£ (Reset Password)** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ, –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ —Å —Ç–æ–∫–µ–Ω–æ–º.  
**4Ô∏è‚É£ –ü–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.**

---

## **üîπ –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –≤—ã–∑–≤–∞—Ç—å `ResetPasswordAsync()` –±–µ–∑ —Ç–æ–∫–µ–Ω–∞?**

- `ResetPasswordAsync(user, token, newPassword)` —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
- –ë–µ–∑ –Ω–µ–≥–æ **–ª—é–±–æ–π –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫** –º–æ–≥ –±—ã –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –¢–æ–∫–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—Ä–æ—Å–∏–ª —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è.

---

## **üìå –í—ã–≤–æ–¥**

‚úîÔ∏è **`Reset Password` –±–µ–∑ `Forgot Password` –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–µ–Ω.**  
‚úîÔ∏è –û–Ω **–≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç—å—é –ø—Ä–æ—Ü–µ—Å—Å–∞** –∏ —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω.  
‚úîÔ∏è `Forgot Password` –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è `Reset Password`.

–ö–æ–Ω–µ—á–Ω–æ! –†–∞–∑–±–µ—Ä–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–æ—Ü–µ—Å—Å **–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞** –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è.

---

### üîπ 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è, –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç **—Å—Å—ã–ª–∫—É —Å —Ç–æ–∫–µ–Ω–æ–º**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
https://example.com/reset-password?token=eyJhbGciOiJIUzI1...
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –≤–º–µ—Å—Ç–µ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```http
POST /api/auth/reset-password
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "email": "user@example.com",
  "newPassword": "NewStrongPassword123!"
}
```

---

### üîπ 2. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –º—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º —Ç–æ–∫–µ–Ω –∏ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º –µ–≥–æ.  
–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **JWT (JSON Web Token)**, –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π:

#### –ü—Ä–∏–º–µ—Ä JWT —Ç–æ–∫–µ–Ω–∞:

```
Header:
{
  "alg": "HS256",
  "typ": "JWT"
}

Payload:
{
  "sub": "user@example.com",
  "exp": 1710000000,
  "jti": "random-unique-id",
  "scope": "password-reset"
}

Signature:
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret-key
)
```

–ß—Ç–æ–±—ã –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ C# (–∏—Å–ø–æ–ª—å–∑—É—è **Microsoft.IdentityModel.Tokens** –∏ **System.IdentityModel.Tokens.Jwt**):

```csharp
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;
using Microsoft.IdentityModel.Tokens;

public ClaimsPrincipal? ValidateToken(string token, string secretKey)
{
    var tokenHandler = new JwtSecurityTokenHandler();
    var key = System.Text.Encoding.UTF8.GetBytes(secretKey);

    var validationParameters = new TokenValidationParameters
    {
        ValidateIssuer = false, // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
        ValidateAudience = false, // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
        ValidateLifetime = true,
        ValidateIssuerSigningKey = true,
        IssuerSigningKey = new SymmetricSecurityKey(key)
    };

    try
    {
        var principal = tokenHandler.ValidateToken(token, validationParameters, out var securityToken);
        var jwtToken = (JwtSecurityToken)securityToken;

        if (jwtToken == null || !jwtToken.Header.Alg.Equals(SecurityAlgorithms.HmacSha256, StringComparison.OrdinalIgnoreCase))
            throw new SecurityTokenException("Invalid token");

        return principal; // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
    }
    catch
    {
        return null; // –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞
    }
}
```

–≠—Ç–æ—Ç –∫–æ–¥:

- **–ü–∞—Ä—Å–∏—Ç JWT** (—Ä–∞–∑–±–∏—Ä–∞–µ—Ç –µ–≥–æ –Ω–∞ —á–∞—Å—Ç–∏).
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å** (–ø–æ–¥–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º –∏ –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å).
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ (`exp`)** (–µ—Å–ª–∏ —Å—Ä–æ–∫ –∏—Å—Ç–µ–∫ ‚Äî —Ç–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω).
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `ClaimsPrincipal`**, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –ø–æ–ª–µ–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

---

### üîπ 3. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞

–ü–æ—Å–ª–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å:

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è (`exp`)**

- –¢–æ–∫–µ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω.

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏**

- –û–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º —Å–µ—Ä–≤–µ—Ä–∞.

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ email**

- –ò–∑–≤–ª–µ–∫–∞–µ–º email –∏–∑ `sub` (–∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ claim) –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å email –≤ –∑–∞–ø—Ä–æ—Å–µ.

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID (`jti`)**

- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î, –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ—Ç `jti` –µ—â—ë –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è.

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ `scope` (–µ—Å–ª–∏ –µ—Å—Ç—å)**

- –ù–∞–ø—Ä–∏–º–µ—Ä, `scope` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `"password-reset"`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç—Ç–æ —Ç–æ–∫–µ–Ω –∏–º–µ–Ω–Ω–æ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è.

---

### üîπ 4. –ò—Ç–æ–≥: —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä

1. **–î–µ–∫–æ–¥–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω** (–∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ).
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å** (—É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –ø–æ–¥–¥–µ–ª–∞–Ω).
3. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (`exp`)**.
4. **–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç email –∏–∑ —Ç–æ–∫–µ–Ω–∞ —Å email –≤ –∑–∞–ø—Ä–æ—Å–µ**.
5. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –±—ã–ª –ª–∏ —Ç–æ–∫–µ–Ω —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω** (–µ—Å–ª–∏ —Ö—Ä–∞–Ω–∏–º –µ–≥–æ –≤ –ë–î).
6. **–ï—Å–ª–∏ –≤—Å–µ –æ–∫ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞—Ä–æ–ª—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**.

---

### üî• –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã JWT

1. **–¢–æ–∫–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
    
    - –í–º–µ—Å—Ç–æ JWT –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π **GUID-—Ç–æ–∫–µ–Ω** –≤ –ë–î –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –µ–≥–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.
    - –ù–æ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î.
2. **OTP (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∫–æ–¥—ã)**
    
    - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∫–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —à–µ—Å—Ç–∏–∑–Ω–∞—á–Ω—ã–µ —á–∏—Å–ª–∞).
    - –ú–∏–Ω—É—Å ‚Äî –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å JWT.

---

### ‚ùì –í–æ–ø—Ä–æ—Å: —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –≤–∞–ª–∏–¥–µ–Ω?

- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω **–ø—Ä–æ—Å—Ä–æ—á–µ–Ω** ‚Üí –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É `400 Bad Request` —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º.
- –ï—Å–ª–∏ **–ø–æ–¥–ø–∏—Å—å –Ω–µ–≤–µ—Ä–Ω–∞—è** ‚Üí –≤–µ—Ä–Ω—É—Ç—å `401 Unauthorized`.
- –ï—Å–ª–∏ **email –≤ —Ç–æ–∫–µ–Ω–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∑–∞–ø—Ä–æ—Å–æ–º** ‚Üí –≤–µ—Ä–Ω—É—Ç—å `403 Forbidden`.

–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

```csharp
var principal = ValidateToken(request.Token, secretKey);
if (principal == null)
    return BadRequest("Invalid or expired token");

var emailFromToken = principal.FindFirstValue(ClaimTypes.NameIdentifier);
if (emailFromToken != request.Email)
    return Forbid(); // 403 Forbidden
```

---

### ‚ú® –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ—Ü–µ—Å—Å **–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞** –≤–∫–ª—é—á–∞–µ—Ç:  
‚úî –†–∞–∑–±–æ—Ä JWT  
‚úî –ü—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ –∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è  
‚úî –°—Ä–∞–≤–Ω–µ–Ω–∏–µ email  
‚úî –ü—Ä–æ–≤–µ—Ä–∫—É `jti` (–µ—Å–ª–∏ —Ö—Ä–∞–Ω–∏–º –≤ –ë–î)  
‚úî –ü—Ä–æ–≤–µ—Ä–∫—É `scope` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º)

–ï—Å–ª–∏ –≤—Å—ë –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚Äî –º–µ–Ω—è–µ–º –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. üîêüöÄ