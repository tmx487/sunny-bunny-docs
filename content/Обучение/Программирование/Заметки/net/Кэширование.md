# 1) –ö–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã–±—Ä–∞—Ç—å?

–î–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ .NET 9 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Clean Architecture –∏ DDD, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

**In-memory –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**:

- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `IMemoryCache` - –ü—Ä–æ—Å—Ç–æ–π, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –æ–¥–Ω–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º
- Microsoft.Extensions.Caching.Memory - –†–µ—à–µ–Ω–∏–µ –æ—Ç Microsoft, —Ö–æ—Ä–æ—à–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å DI

**–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**:

- Redis - –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ, –±–æ–≥–∞—Ç–æ–µ —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –æ—Ç—Ä–∞—Å–ª–µ–≤–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç
- Microsoft.Extensions.Caching.SqlServer - –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∫—ç—à –Ω–∞ –±–∞–∑–µ SQL Server
- Microsoft.Extensions.Caching.StackExchangeRedis - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis-–∫–ª–∏–µ–Ω—Ç–æ–º

**–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ Redis —è–≤–ª—è–µ—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º**, –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ø–æ–ª–∏—Ç–∏–∫–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ, pub/sub)
4. –•–æ—Ä–æ—à–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è —Å —Ä–æ—Å—Ç–æ–º –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. –ò–º–µ–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å .NET —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Microsoft

# 2) –ü–æ–¥—Ö–æ–¥ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è Clean Architecture + DDD

–í–æ—Ç –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Redis –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:

### –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã NuGet

```bash
dotnet add package Microsoft.Extensions.Caching.StackExchangeRedis
dotnet add package Microsoft.Extensions.Caching.Abstractions
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –∫—ç—à–∞ –≤ –≤–∞—à–µ–º –æ—Å–Ω–æ–≤–Ω–æ–º –¥–æ–º–µ–Ω–µ

–°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–ª–æ–µ Domain –∏–ª–∏ Application:

```csharp
// Domain/Infrastructure/Interfaces/ICacheService.cs
public interface ICacheService
{
    Task<T?> GetAsync<T>(string key, CancellationToken cancellationToken = default);
    Task SetAsync<T>(string key, T value, TimeSpan? expiration = null, CancellationToken cancellationToken = default);
    Task RemoveAsync(string key, CancellationToken cancellationToken = default);
    Task<T> GetOrCreateAsync<T>(string key, Func<Task<T>> factory, TimeSpan? expiration = null, CancellationToken cancellationToken = default);
}
```

### –®–∞–≥ 3: –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Redis

–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ —Å–ª–æ–µ Infrastructure:

```csharp
// Infrastructure/Services/RedisCacheService.cs
using Microsoft.Extensions.Caching.Distributed;
using System.Text.Json;

public class RedisCacheService : ICacheService
{
    private readonly IDistributedCache _distributedCache;
    
    public RedisCacheService(IDistributedCache distributedCache)
    {
        _distributedCache = distributedCache;
    }

    public async Task<T?> GetAsync<T>(string key, CancellationToken cancellationToken = default)
    {
        var cachedData = await _distributedCache.GetStringAsync(key, cancellationToken);
        
        if (string.IsNullOrEmpty(cachedData))
            return default;
            
        return JsonSerializer.Deserialize<T>(cachedData);
    }

    public async Task SetAsync<T>(string key, T value, TimeSpan? expiration = null, CancellationToken cancellationToken = default)
    {
        var options = new DistributedCacheEntryOptions();
        
        if (expiration.HasValue)
            options.AbsoluteExpirationRelativeToNow = expiration;
            
        var serializedData = JsonSerializer.Serialize(value);
        await _distributedCache.SetStringAsync(key, serializedData, options, cancellationToken);
    }

    public async Task RemoveAsync(string key, CancellationToken cancellationToken = default)
    {
        await _distributedCache.RemoveAsync(key, cancellationToken);
    }

    public async Task<T> GetOrCreateAsync<T>(string key, Func<Task<T>> factory, TimeSpan? expiration = null, CancellationToken cancellationToken = default)
    {
        var cachedValue = await GetAsync<T>(key, cancellationToken);
        
        if (cachedValue != null)
            return cachedValue;
            
        var newValue = await factory();
        await SetAsync(key, newValue, expiration, cancellationToken);
        return newValue;
    }
}
```

### –®–∞–≥ 4: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –≤–∞—à–µ–º DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

–í –≤–∞—à–µ–º startup –∏–ª–∏ program.cs:

```csharp
// Program.cs –∏–ª–∏ Startup.cs
public void ConfigureServices(IServiceCollection services)
{
    // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∫—ç—à Redis
    services.AddStackExchangeRedisCache(options =>
    {
        options.Configuration = Configuration.GetConnectionString("Redis");
        options.InstanceName = "YourAppName:";
    });
    
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    services.AddScoped<ICacheService, RedisCacheService>();
    
    // –î—Ä—É–≥–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤...
}
```

### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à appsettings.json

```json
{
  "ConnectionStrings": {
    "Redis": "localhost:6379"
  }
}
```

### –®–∞–≥ 6: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–Ω–µ–¥—Ä–∏—Ç—å `ICacheService` –≤ –≤–∞—à–∏ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í–æ—Ç –∫–∞–∫ –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤:

```csharp
// Application/Features/SomeFeature/Queries/GetSomeEntityQueryHandler.cs
public class GetSomeEntityQueryHandler : IRequestHandler<GetSomeEntityQuery, SomeEntityDto>
{
    private readonly IRepository<SomeEntity> _repository;
    private readonly ICacheService _cacheService;
    
    public GetSomeEntityQueryHandler(IRepository<SomeEntity> repository, ICacheService cacheService)
    {
        _repository = repository;
        _cacheService = cacheService;
    }
    
    public async Task<SomeEntityDto> Handle(GetSomeEntityQuery request, CancellationToken cancellationToken)
    {
        var cacheKey = $"entity:{request.Id}";
        
        return await _cacheService.GetOrCreateAsync<SomeEntityDto>(
            cacheKey,
            async () => {
                var entity = await _repository.GetByIdAsync(request.Id);
                return entity != null ? new SomeEntityDto(entity) : null;
            },
            TimeSpan.FromMinutes(30),
            cancellationToken
        );
    }
}
```

### –®–∞–≥ 7: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –≤ –≤–∞—à–∏—Ö –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞—Ö

–ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è, –≤–∞–º –Ω—É–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∫–æ–º–∞–Ω–¥:

```csharp
// Application/Features/SomeFeature/Commands/UpdateSomeEntityCommandHandler.cs
public class UpdateSomeEntityCommandHandler : IRequestHandler<UpdateSomeEntityCommand, Unit>
{
    private readonly IRepository<SomeEntity> _repository;
    private readonly ICacheService _cacheService;
    
    public UpdateSomeEntityCommandHandler(IRepository<SomeEntity> repository, ICacheService cacheService)
    {
        _repository = repository;
        _cacheService = cacheService;
    }
    
    public async Task<Unit> Handle(UpdateSomeEntityCommand request, CancellationToken cancellationToken)
    {
        var entity = await _repository.GetByIdAsync(request.Id);
        if (entity == null)
            throw new NotFoundException(nameof(SomeEntity), request.Id);
            
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ —Å—É—â–Ω–æ—Å—Ç–∏
        entity.Update(request.Name, request.Description);
        
        await _repository.UpdateAsync(entity);
        
        // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à
        await _cacheService.RemoveAsync($"entity:{request.Id}", cancellationToken);
        
        return Unit.Value;
    }
}
```

## –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –∫–ª–∞—Å—Å–∞ RedisCacheService:

–ö–ª–∞—Å—Å `RedisCacheService` - —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `ICacheService`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä**:
    
    ```csharp
    public RedisCacheService(IDistributedCache distributedCache)
    {
        _distributedCache = distributedCache;
    }
    ```
    
    –ö–ª–∞—Å—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `IDistributedCache` —á–µ—Ä–µ–∑ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. `IDistributedCache` - —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –∏–∑ Microsoft –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª—é–±—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –∫—ç—à–µ–º (–≤–∫–ª—é—á–∞—è Redis).
    
2. **GetAsync**:
    
    ```csharp
    public async Task<T?> GetAsync<T>(string key, CancellationToken cancellationToken = default)
    {
        var cachedData = await _distributedCache.GetStringAsync(key, cancellationToken);
        
        if (string.IsNullOrEmpty(cachedData))
            return default;
            
        return JsonSerializer.Deserialize<T>(cachedData);
    }
    ```
    
    –≠—Ç–æ—Ç –º–µ—Ç–æ–¥:
    
    - –ü–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞ –ø–æ –∫–ª—é—á—É –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –ø—É—Å—Ç–æ–µ –ª–∏ –æ–Ω–æ
    - –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç JSON —Å—Ç—Ä–æ–∫—É –≤ –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ T
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
3. **SetAsync**:
    
    ```csharp
    public async Task SetAsync<T>(string key, T value, TimeSpan? expiration = null, CancellationToken cancellationToken = default)
    {
        var options = new DistributedCacheEntryOptions();
        
        if (expiration.HasValue)
            options.AbsoluteExpirationRelativeToNow = expiration;
            
        var serializedData = JsonSerializer.Serialize(value);
        await _distributedCache.SetStringAsync(key, serializedData, options, cancellationToken);
    }
    ```
    
    –≠—Ç–æ—Ç –º–µ—Ç–æ–¥:
    
    - –°–æ–∑–¥–∞–µ—Ç –æ–ø—Ü–∏–∏ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –∑–∞–ø–∏—Å–∏ –≤ –∫—ç—à–µ)
    - –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –æ–±—ä–µ–∫—Ç –≤ JSON —Å—Ç—Ä–æ–∫—É
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ –∫—ç—à–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∫–ª—é—á—É
4. **RemoveAsync**:
    
    ```csharp
    public async Task RemoveAsync(string key, CancellationToken cancellationToken = default)
    {
        await _distributedCache.RemoveAsync(key, cancellationToken);
    }
    ```
    
    –ü—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∫–ª—é—á—É.
    
5. **GetOrCreateAsync**:
    
    ```csharp
    public async Task<T> GetOrCreateAsync<T>(string key, Func<Task<T>> factory, TimeSpan? expiration = null, CancellationToken cancellationToken = default)
    {
        var cachedValue = await GetAsync<T>(key, cancellationToken);
        
        if (cachedValue != null)
            return cachedValue;
            
        var newValue = await factory();
        await SetAsync(key, newValue, expiration, cancellationToken);
        return newValue;
    }
    ```
    
    –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ø–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å":
    
    - –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞
    - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ
    - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Ñ–∞–±—Ä–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫—ç—à–µ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ –æ–±—â–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Redis –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫—ç—à–µ–º –ø–æ –≤—Å–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é, —Å–æ–±–ª—é–¥–∞—è –ø—Ä–∏–Ω—Ü–∏–ø—ã Clean Architecture, –≥–¥–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (Redis) –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–æ –≤–Ω–µ—à–Ω–µ–º —Å–ª–æ–µ, –∞ –¥–æ–º–µ–Ω –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é.

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–≥–æ `ICacheService`, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ —Å—Ç–æ–∏—Ç –≤–∫–ª—é—á–∏—Ç—å –≤ –≤–∞—à—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –í–æ—Ç –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –∏ –∫–∞–∫ –ª—É—á—à–µ –ø–æ–¥–æ–π—Ç–∏ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:

### –ü—Ä–∏—á–∏–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    
2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏** ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –º–µ—Ç–æ–¥–∞—Ö –≤—Ä–æ–¥–µ `GetOrCreateAsync`, –≥–¥–µ –µ—Å—Ç—å —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏ –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    
3. **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** ‚Äî —Å–µ—Ä–≤–∏—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
    
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π** ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Redis –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
    

### –ü–æ–¥—Ö–æ–¥—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:

#### 1. –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –º–æ–∫–∞–º–∏

```csharp
[Fact]
public async Task GetAsync_WhenKeyExists_ReturnsDeserializedValue()
{
    // Arrange
    var mockDistributedCache = new Mock<IDistributedCache>();
    var testData = new TestModel { Id = 1, Name = "Test" };
    var serializedData = JsonSerializer.Serialize(testData);
    
    mockDistributedCache
        .Setup(x => x.GetStringAsync("test-key", It.IsAny<CancellationToken>()))
        .ReturnsAsync(serializedData);
    
    var cacheService = new RedisCacheService(mockDistributedCache.Object);
    
    // Act
    var result = await cacheService.GetAsync<TestModel>("test-key");
    
    // Assert
    Assert.NotNull(result);
    Assert.Equal(1, result.Id);
    Assert.Equal("Test", result.Name);
}

[Fact]
public async Task GetAsync_WhenKeyDoesNotExist_ReturnsDefault()
{
    // Arrange
    var mockDistributedCache = new Mock<IDistributedCache>();
    
    mockDistributedCache
        .Setup(x => x.GetStringAsync("test-key", It.IsAny<CancellationToken>()))
        .ReturnsAsync((string)null);
    
    var cacheService = new RedisCacheService(mockDistributedCache.Object);
    
    // Act
    var result = await cacheService.GetAsync<TestModel>("test-key");
    
    // Assert
    Assert.Null(result);
}
```

#### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º Redis-—Å–µ—Ä–≤–µ—Ä–æ–º

–î–ª—è –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä Redis:

```csharp
public class RedisCacheServiceIntegrationTests : IDisposable
{
    private readonly TestServer _testServer;
    private readonly ICacheService _cacheService;
    
    public RedisCacheServiceIntegrationTests()
    {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º Redis
        // (–æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ TestContainers –∏–ª–∏ –¥—Ä—É–≥—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Redis –≤ —Ç–µ—Å—Ç–∞—Ö)
        var builder = new WebHostBuilder()
            .ConfigureServices(services => 
            {
                services.AddStackExchangeRedisCache(options =>
                {
                    options.Configuration = "localhost:6379"; // –¢–µ—Å—Ç–æ–≤—ã–π Redis
                });
                services.AddScoped<ICacheService, RedisCacheService>();
            });
            
        _testServer = new TestServer(builder);
        _cacheService = _testServer.Services.GetRequiredService<ICacheService>();
    }
    
    [Fact]
    public async Task GetOrCreateAsync_CreatesValueWhenNotInCache()
    {
        // Arrange
        var testObject = new TestModel { Id = 42, Name = "Integration Test" };
        var factoryCalled = false;
        
        // Act
        var result = await _cacheService.GetOrCreateAsync<TestModel>(
            "integration-test-key",
            async () => {
                factoryCalled = true;
                return testObject;
            },
            TimeSpan.FromMinutes(5)
        );
        
        // –ü–æ–ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ—Ç –∂–µ –∫–ª—é—á
        var cachedResult = await _cacheService.GetAsync<TestModel>("integration-test-key");
        
        // Assert
        Assert.True(factoryCalled);
        Assert.Equal(42, result.Id);
        Assert.Equal("Integration Test", result.Name);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –±—ã–ª–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∫—ç—à–µ
        Assert.NotNull(cachedResult);
        Assert.Equal(42, cachedResult.Id);
    }
    
    public void Dispose()
    {
        _testServer?.Dispose();
    }
}
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

1. **–ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
2. **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è TTL
3. **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
4. **GetOrCreateAsync** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤–µ—Ç–≤–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–µ—Å—Ç—å –≤ –∫—ç—à–µ/–Ω–µ—Ç –≤ –∫—ç—à–µ)
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Redis
6. **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö (–µ—Å–ª–∏ —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:

–£—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Clean Architecture –∏ DDD, —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:

1. –ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–±–æ—Ä –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `RedisCacheService` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤ –¥–ª—è `IDistributedCache`
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º Redis (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker –∏ TestContainers –¥–ª—è –∏—Ö –∑–∞–ø—É—Å–∫–∞)
3. –í–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `ICacheService`, –ø—Ä–æ–≤–µ—Ä—è—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ç–æ–º, —á—Ç–æ –≤–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –Ω–µ —Å—Ç–∞–Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–æ–±–ª–µ–º –≤ –±—É–¥—É—â–µ–º.

# **GetAsync() vd GetStringAsync()**

–í .NET API –¥–ª—è Redis –µ—Å—Ç—å –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–∞: `GetAsync()` –∏ `GetStringAsync()`. –ò—Ö –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è —Å–≤—è–∑–∞–Ω—ã —Å —Ç–∏–ø–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å–ø–æ—Å–æ–±–æ–º –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏:

### GetStringAsync()

- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Task<string>` - —Å—Ç—Ä–æ–∫—É –Ω–∞–ø—Ä—è–º—É—é
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ö–æ–≥–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, JSON, XML, –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç)
- **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: Redis –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ –≤ —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8
- **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
    
    ```csharp
    string jsonData = await distributedCache.GetStringAsync("myKey");// –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å jsonData, –µ—Å–ª–∏ —ç—Ç–æ JSON
    ```
    

### GetAsync()

- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Task<byte[]>` - –º–∞—Å—Å–∏–≤ –±–∞–π—Ç–æ–≤
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ö–æ–≥–¥–∞ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –±–∞–π—Ç—ã –∏–∑ Redis –±–µ–∑ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
    
    ```csharp
    byte[] rawData = await distributedCache.GetAsync("myKey");// –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–∞–π—Ç—ã –∫–∞–∫ –≤–∞–º –Ω—É–∂–Ω–æ
    ```
    

### –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GetStringAsync()`, –∫–æ–≥–¥–∞:
    
    - –í—ã —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (JSON, XML –∏ —Ç.–¥.)
    - –í–∞–º –Ω—É–∂–Ω–æ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–æ–∫—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GetAsync()`, –∫–æ–≥–¥–∞:
    
    - –í—ã —Ö—Ä–∞–Ω–∏—Ç–µ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ñ–∞–π–ª—ã –∏ —Ç.–¥.)
    - –í–∞–º –Ω—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
    - –í—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –∫–æ–¥–∏—Ä–æ–≤–∫—É, –æ—Ç–ª–∏—á–Ω—É—é –æ—Ç UTF-8

–í –Ω–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `RedisCacheService` –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `GetStringAsync()`, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º –æ–±—ä–µ–∫—Ç—ã –≤ JSON, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –ª–µ–≥–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏ C# –∏ —Ñ–æ—Ä–º–∞—Ç–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Redis.

# **From ChatGPT: –≤—ã–Ω–µ—Å—Ç–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ AOP —á–µ—Ä–µ–∑ Decorator –∏–ª–∏ Behavior**

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –ø–æ Clean Architecture –∏ DDD.  
–ö–æ–≥–¥–∞ —è —Å–∫–∞–∑–∞–ª _"–≤—ã–Ω–µ—Å—Ç–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ AOP —á–µ—Ä–µ–∑ Decorator –∏–ª–∏ Behavior"_, —è –∏–º–µ–ª –≤ –≤–∏–¥—É **–æ—Ç–¥–µ–ª–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏**, —á—Ç–æ–±—ã –æ–Ω–∞ –æ—Å—Ç–∞–ª–∞—Å—å —á–∏—Å—Ç–æ–π, –∞ –∫—ç—à –±—ã–ª –ø–æ–¥–∫–ª—é—á–µ–Ω –∫–∞–∫ **–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞**. –≠—Ç–æ –∏ –µ—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ **–∞—Å–ø–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (AOP)**.

---

## üìå –ß—Ç–æ —Ç–∞–∫–æ–µ AOP (Aspect-Oriented Programming)?

AOP –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å **–ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫ –∫–æ–¥—É –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∞–º–æ–≥–æ –∫–æ–¥–∞**.  
–ù–∞–ø—Ä–∏–º–µ—Ä, —Ç—ã –º–æ–∂–µ—à—å –æ–±–µ—Ä–Ω—É—Ç—å –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –ª–æ–≥–∏–∫–æ–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ —Ç.–¥., –Ω–µ —Ç—Ä–æ–≥–∞—è –æ—Å–Ω–æ–≤–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.

---

## ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: –ö—ç—à-–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä (Decorator Pattern)

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —É —Ç–µ–±—è –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```csharp
public interface IProductService
{
    Task<ProductDto?> GetByIdAsync(Guid id);
}
```

### üéÅ –°–æ–∑–¥–∞—ë–º –∫—ç—à-–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä:

```csharp
public class CachedProductService : IProductService
{
    private readonly IProductService _inner;
    private readonly ICacheService _cache;
    private const string CachePrefix = "product:";

    public CachedProductService(IProductService inner, ICacheService cache)
    {
        _inner = inner;
        _cache = cache;
    }

    public async Task<ProductDto?> GetByIdAsync(Guid id)
    {
        string key = $"{CachePrefix}{id}";
        var cached = await _cache.GetAsync<ProductDto>(key);

        if (cached is not null)
            return cached;

        var result = await _inner.GetByIdAsync(id);
        if (result != null)
            await _cache.SetAsync(key, result, TimeSpan.FromMinutes(5));

        return result;
    }
}
```

### üîß –í `DI`-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```csharp
services.AddScoped<IProductService, ProductService>(); // –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
services.Decorate<IProductService, CachedProductService>(); // –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∫—ç—à-–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º
```

> `Decorate<TInterface, TDecorator>()` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å **Scrutor** ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏ —á–µ—Ä–µ–∑ `dotnet add package Scrutor`.

---

## ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–≤–µ–¥–µ–Ω–∏–µ (Behavior) –≤ MediatR ‚Äî –ø–æ–¥—Ö–æ–¥ CQRS

–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å MediatR –¥–ª—è CQRS, –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å **Pipeline Behavior**, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫—ç—à –¥–æ –≤—ã–∑–æ–≤–∞ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Å–ª–µ:

```csharp
public class CachingBehavior<TRequest, TResponse> : IPipelineBehavior<TRequest, TResponse>
    where TRequest : ICachableRequest
{
    private readonly ICacheService _cache;

    public CachingBehavior(ICacheService cache)
    {
        _cache = cache;
    }

    public async Task<TResponse> Handle(
        TRequest request,
        RequestHandlerDelegate<TResponse> next,
        CancellationToken cancellationToken)
    {
        var key = request.GetCacheKey();
        var cached = await _cache.GetAsync<TResponse>(key);

        if (cached is not null)
            return cached;

        var result = await next();

        await _cache.SetAsync(key, result, TimeSpan.FromMinutes(5));
        return result;
    }
}
```

–ò –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã —Ö–æ—á–µ—à—å –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å, —Ä–µ–∞–ª–∏–∑—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```csharp
public interface ICachableRequest
{
    string GetCacheKey();
}
```

---

## ‚ú® –ü–ª—é—Å—ã –ø–æ–¥—Ö–æ–¥–∞:

- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ "–∑–Ω–∞–µ—Ç" –ø—Ä–æ –∫—ç—à
    
- –ö—ç—à –ª–µ–≥–∫–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∏–ª–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è
    
- –£–ø—Ä–æ—â–∞–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ
    
- –í—Å—ë –ø–æ SOLID (–æ—Å–æ–±–µ–Ω–Ω–æ Single Responsibility)
    

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É:

- –ü–æ–º–æ—á—å –≤–Ω–µ–¥—Ä–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ
    
- –ù–∞–ø–∏—Å–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –∫—ç—à-behavior –ø–æ–¥ —Ç–≤–æ–∏ –∑–∞–ø—Ä–æ—Å—ã
    
- –ò–ª–∏ –¥–∞–∂–µ —Å–¥–µ–ª–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π `GetOrAddAsync` –Ω–∞ –±–∞–∑–µ Redis
    

–¢–µ–±–µ –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –±–ª–∏–∂–µ ‚Äî —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏–ª–∏ —á–µ—Ä–µ–∑ MediatR behavior?