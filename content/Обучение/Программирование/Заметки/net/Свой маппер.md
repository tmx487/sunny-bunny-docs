
Создание собственного маппера в .NET, который будет выполнять преобразование одного объекта в другой наподобие `AutoMapper`, требует нескольких шагов. Мы создадим базовый пример маппера, который будет включать в себя регистрацию маппингов, выполнение маппинга, а также возможность расширения.

### Шаги создания собственного маппера:

#### 1. **Создайте интерфейс маппера:**

Для начала, определим интерфейс, который будет использоваться для маппинга объектов.

```csharp
public interface IMapper
{
    TDestination Map<TSource, TDestination>(TSource source);
}
```

#### 2. **Создайте интерфейс для маппинга типов:**

Мы создадим интерфейс, который будет описывать маппинг одного типа на другой.

```csharp
public interface ITypeMap<TSource, TDestination>
{
    TDestination Map(TSource source);
}
```

#### 3. **Реализуйте базовый маппер:**

Теперь реализуем класс, который будет управлять маппингами и выполнять их.

```csharp
using System;
using System.Collections.Generic;

public class SimpleMapper : IMapper
{
    private readonly Dictionary<(Type, Type), object> _mappings = new();

    // Регистрация маппинга между двумя типами
    public void Register<TSource, TDestination>(ITypeMap<TSource, TDestination> map)
    {
        _mappings[(typeof(TSource), typeof(TDestination))] = map;
    }

    // Выполнение маппинга
    public TDestination Map<TSource, TDestination>(TSource source)
    {
        if (_mappings.TryGetValue((typeof(TSource), typeof(TDestination)), out var map))
        {
            var typeMap = map as ITypeMap<TSource, TDestination>;
            return typeMap.Map(source);
        }

        throw new InvalidOperationException($"No mapping found for {typeof(TSource)} to {typeof(TDestination)}");
    }
}
```

#### 4. **Создайте конкретные маппинги:**

Теперь нужно создать конкретные маппинги для ваших типов.

```csharp
public class StudentToPersonMap : ITypeMap<Student, PersonDto>
{
    public PersonDto Map(Student source)
    {
        return new PersonDto
        {
            FullName = $"{source.FirstName} {source.LastName}",
            Age = source.Age
        };
    }
}
```

#### 5. **Используйте маппер:**

Теперь вы можете использовать свой маппер для преобразования объектов.

```csharp
var mapper = new SimpleMapper();

// Регистрация маппинга
mapper.Register(new StudentToPersonMap());

var student = new Student
{
    FirstName = "John",
    LastName = "Doe",
    Age = 21
};

// Выполнение маппинга
var personDto = mapper.Map<Student, PersonDto>(student);

Console.WriteLine(personDto.FullName); // John Doe
```

### Дополнительные возможности:

- **Поддержка сложных маппингов:** Можно добавить поддержку сложных маппингов, например, для вложенных объектов или коллекций.
- **Настройки маппинга:** Можно добавить возможность конфигурации маппингов, например, исключения полей, использования пользовательских логик и т. д.
- **Кеширование:** Если маппинги сложные и выполняются часто, можно добавить кеширование результатов.

### Заключение

Этот простой пример демонстрирует, как создать базовый маппер. Конечно, возможности `AutoMapper` гораздо шире, и включают автоматическое сканирование сборок на наличие маппингов, работу с выражениями, автоматическое маппирование полей и свойств с одинаковыми именами и многое другое. Однако, свой маппер может быть полезен в тех случаях, когда требуется более легковесное или специализированное решение.