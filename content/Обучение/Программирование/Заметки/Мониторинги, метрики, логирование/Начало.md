# üéØ–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```text
Application (.NET) ‚Üí Metrics/Logs ‚Üí Prometheus/Loki ‚Üí Grafana Dashboard
```


## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ –∏–∑ –∫–æ—Ä–æ–±–∫–∏:

**Prometheus + Grafana:**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ `job` –∏ `instance` labels
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç service discovery –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –ø–æ –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

**Loki:**

- –°–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ —Å–æ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –ø–æ –º–µ—Ç–∫–∞–º (service, environment, version)
- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ª–æ–≥–æ–≤ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ –ø–æ trace ID

**Alerting:**

- –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ì—Ä—É–ø–ø–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ä–≤–∏—Å–∞

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤:

1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ** - –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–¥–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
2. **[[Distributed tracing]] –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** - —Å OpenTelemetry
3. **[[Service mesh]] —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å Istio, Linkerd
4. **Auto-discovery** - –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. **Cross-service –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è** - —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å:

1. **Service Discovery** - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è Kubernetes/Docker Swarm
2. **Labeling strategy** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. **Dashboards** - —Å–æ–∑–¥–∞—Ç—å overview + –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
4. **Alert routing** - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –ø–æ –∫–æ–º–∞–Ω–¥–∞–º/—Å–µ—Ä–≤–∏—Å–∞–º
5. **Log correlation** - –¥–æ–±–∞–≤–∏—Ç—å correlation ID –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- **Jaeger/Zipkin** –¥–ª—è distributed tracing
- **Service mesh –º–µ—Ç—Ä–∏–∫–∏** (latency –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏)
- **Business metrics** –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ
- **[[Canary deployment]] –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

–í —Ü–µ–ª–æ–º, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –æ—Ç 1 –¥–æ 100+ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º!

## üéØ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### **–≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ .NET –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ NuGet –ø–∞–∫–µ—Ç—ã** –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ –≤—ã—à–µ
2. **–ó–∞–º–µ–Ω–∏—Ç–µ Program.cs** –Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥
3. **–î–æ–±–∞–≤—å—Ç–µ –≤ appsettings.json**:

```json
{
  "ConnectionStrings": {
    "Loki": "http://localhost:3100"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}
```

### **–≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**

1. **–°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫**:

```bash
mkdir -p monitoring/{prometheus,grafana,loki,alertmanager}
```

2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –≤—ã—à–µ
    
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**:
    

```bash
chmod +x setup-monitoring.sh
./setup-monitoring.sh
```

### **–≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ .NET –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**:

```bash
dotnet run --urls="http://localhost:5000"
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏**:
    
    - –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5000/metrics
    - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è Prometheus –º–µ—Ç—Ä–∏–∫–∏
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**:
    
    - –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ Loki
    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Grafana Explore

### **–≠—Ç–∞–ø 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤**

1. **–í–æ–π–¥–∏—Ç–µ –≤ Grafana** (http://localhost:3000, admin/admin123)
2. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞—à–±–æ—Ä–¥** –∏–∑ JSON —Ñ–∞–π–ª–∞
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã** –≤ AlertManager

## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### **Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:**

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
    
    - –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL/TLS
    - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –ø–æ IP
2. **–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**:
    
    - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ external volumes
    - –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã
    - Retention policies
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**:
    
    - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ external storage (S3, GCS)
    - –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è Loki
    - Load balancing

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ–∫-–ª–∏—Å—Ç:**

‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏  
‚úÖ –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
‚úÖ –ê–ª–µ—Ä—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π  
‚úÖ –î–∞—à–±–æ—Ä–¥—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏  
‚úÖ Health checks  
‚úÖ Performance –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–≠—Ç–æ—Ç —Å—Ç–µ–∫ –¥–∞—Å—Ç –≤–∞–º –ø–æ–ª–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ production –∏ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã!