### **1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ .NET –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö**

**–õ–æ–≥–∏:**

```
User Service ‚Üí Console: "[INFO] User 123 authenticated"
Order Service ‚Üí Console: "[INFO] Order created for user 123"
Payment Service ‚Üí Console: "[ERROR] Payment failed for order 456"
```

**–ú–µ—Ç—Ä–∏–∫–∏:**

```
User Service ‚Üí /metrics endpoint: http_requests_total{method="GET",endpoint="/users"} 150
Order Service ‚Üí /metrics endpoint: response_time_seconds{endpoint="/orders"} 0.25
Payment Service ‚Üí /metrics endpoint: payment_failures_total 5
```

### **2. –°–±–æ—Ä –ª–æ–≥–æ–≤ (Promtail)**

**Promtail** (–∞–≥–µ–Ω—Ç-—Å–±–æ—Ä—â–∏–∫) —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ "–ø—ã–ª–µ—Å–æ—Å":

1. **–°–∫–∞–Ω–∏—Ä—É–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
2. **–ß–∏—Ç–∞–µ—Ç –ª–æ–≥–∏** –∏–∑ `/var/lib/docker/containers/*/`
3. **–ü–∞—Ä—Å–∏—Ç –∏ –æ–±–æ–≥–∞—â–∞–µ—Ç** –¥–∞–Ω–Ω—ã–µ:

```
–ò—Å—Ö–æ–¥–Ω—ã–π –ª–æ–≥: "[INFO] User 123 authenticated"

–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- timestamp: 2024-01-15T10:30:00Z
- level: INFO
- message: "User 123 authenticated"
- container_name: user-service
- service: user-service
```

4. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Loki** –ø–æ HTTP

### **3. –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (Prometheus)**

**Prometheus** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ "–æ–ø—Ä–æ—Å—á–∏–∫":

1. **–ö–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥** –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ endpoints
2. **–ó–∞–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏** —Å `/metrics` –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:
    
```
GET http://user-service:5000/metrics
GET http://order-service:5001/metrics
GET http://payment-service:5002/metrics
```
    
3. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å –º–µ—Ç–∫–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏**:
    
```
http_requests_total{service="user-service", method="GET"} 150 @1642248600
http_requests_total{service="order-service", method="POST"} 75 @1642248600
```

### **4. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**

**Loki (–ª–æ–≥–∏):**

- –•—Ä–∞–Ω–∏—Ç –ª–æ–≥–∏ –∫–∞–∫ **–ø–æ—Ç–æ–∫–∏ —Å –º–µ—Ç–∫–∞–º–∏**
- –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ **–º–µ—Ç–∫–∏** (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
- –°–∂–∏–º–∞–µ—Ç –∏ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

**Prometheus (–º–µ—Ç—Ä–∏–∫–∏):**

- –•—Ä–∞–Ω–∏—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ **time-series –±–∞–∑–µ**
- –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –º–µ—Ç–∫–∞–º
- –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º (retention)

### **5. –ê–Ω–∞–ª–∏–∑ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (Grafana)**

**Grafana** –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:

1. **–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Prometheus** –¥–ª—è –º–µ—Ç—Ä–∏–∫
2. **–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Loki** –¥–ª—è –ª–æ–≥–æ–≤
3. **–°–æ–∑–¥–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥—ã** —Å –ø–∞–Ω–µ–ª—è–º–∏:
    
 ```
Dashboard "Microservices Overview":
‚îú‚îÄ‚îÄ Panel 1: RPS –ø–æ –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º (Prometheus)
‚îú‚îÄ‚îÄ Panel 2: Response time 95th percentile (Prometheus)
‚îú‚îÄ‚îÄ Panel 3: Error rate (Prometheus)
‚îî‚îÄ‚îÄ Panel 4: Recent error logs (Loki)
 ```

### **6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥**

**Prometheus –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞:**

1. **–ö–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç conditions:
    
```
IF error_rate > 5% FOR 2 minutes
THEN trigger "HighErrorRate" alert
```
    
2. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª–µ—Ä—Ç –≤ AlertManager**
    

**AlertManager –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–ª–µ—Ä—Ç—ã:**

1. **–ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç** –ø–æ—Ö–æ–∂–∏–µ –∞–ª–µ—Ä—Ç—ã
2. **–ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏**:
    
```
IF severity=critical ‚Üí Slack + Email + PagerDuty
IF service=payment ‚Üí Payment team
IF severity=warning ‚Üí Only Slack
```
    
3. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**

### **7. Incident Response (—Ä–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)**

**–°—Ü–µ–Ω–∞—Ä–∏–π: Payment Service –ø–∞–¥–∞–µ—Ç**

1. **00:00** - Payment Service –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å
2. **00:01** - Prometheus –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏, up{service="payment"} = 0
3. **00:02** - –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–ª–µ—Ä—Ç "ServiceDown"
4. **00:02** - AlertManager –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Slack: "üö® Payment Service is down"
5. **00:03** - –î–µ–≤–µ–ª–æ–ø–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Grafana
6. **00:04** - –°–º–æ—Ç—Ä–∏—Ç –ª–æ–≥–∏ –≤ Loki: –≤–∏–¥–∏—Ç "OutOfMemoryException"
7. **00:05** - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–∞–º—è—Ç–∏ –≤ Prometheus
8. **00:07** - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é

### **8. –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ OpenTelemetry)**

**Trace ID —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è:**

```
Request ID: abc-123-def

Logs –≤ Loki:
[10:30:01] User Service: "Authentication started" trace_id=abc-123-def
[10:30:02] Order Service: "Creating order" trace_id=abc-123-def  
[10:30:03] Payment Service: "Payment failed" trace_id=abc-123-def

–ú–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus:
request_duration{trace_id=abc-123-def, service=user} 0.1s
request_duration{trace_id=abc-123-def, service=order} 0.3s
request_duration{trace_id=abc-123-def, service=payment} 2.5s ‚Üê –ø—Ä–æ–±–ª–µ–º–∞!
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–ª–Ω–∞—è –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

–¢—ã –ø–æ–ª—É—á–∞–µ—à—å **–µ–¥–∏–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É** –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ –≤ —Å–∏—Å—Ç–µ–º–µ:

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç** (–ª–æ–≥–∏)
- **–ö–∞–∫ –±—ã—Å—Ç—Ä–æ** (–º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- **–ù–∞—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ** (–º–µ—Ç—Ä–∏–∫–∏ –æ—à–∏–±–æ–∫)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å drill-down** –æ—Ç –æ–±—â–∏—Ö –º–µ—Ç—Ä–∏–∫ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ª–æ–≥–∞–º9