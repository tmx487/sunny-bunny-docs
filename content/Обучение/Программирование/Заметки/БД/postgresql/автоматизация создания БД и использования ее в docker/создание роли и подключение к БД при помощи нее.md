PostgreSQL позволяет настроить скрипт таким образом, чтобы сначала создать роль с определенными правами, затем подключиться к базе данных с использованием этой роли, а после этого выполнять любые операции с базой данных.

### Пример SQL-скрипта

```sql
-- 1. Создаем роль с логином и паролем
CREATE ROLE phonebook_user WITH LOGIN PASSWORD 'secure_password';

-- 2. Создаем базу данных
CREATE DATABASE phonebook_db OWNER phonebook_user;

-- 3. Подключаемся к базе данных (для выполнения следующих команд нужно будет быть подключенным к phonebook_db)

-- Пример команды для подключения (исполняется из shell или другого клиента):
-- psql -U phonebook_user -d phonebook_db -h localhost

-- 4. Настраиваем права доступа в базе данных (эта часть выполняется после подключения к phonebook_db)
GRANT CONNECT ON DATABASE phonebook_db TO phonebook_user;
GRANT USAGE ON SCHEMA public TO phonebook_user;
GRANT ALL ON ALL TABLES IN SCHEMA public TO phonebook_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO phonebook_user;
```

---

### Как автоматизировать это в Docker

Если вы используете Docker, вы можете поместить этот скрипт в каталог `docker-entrypoint-initdb.d`, чтобы он исполнился автоматически при старте контейнера PostgreSQL.

#### Пример структуры проекта
```
project/
├── docker-compose.yaml
├── init-scripts/
│   └── init.sql
```

#### Пример `docker-compose.yaml`
```yaml
version: '3.9'

services:
  postgres:
    image: postgres:latest
    container_name: postgresql
    restart: always
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin123
    volumes:
      - ./init-scripts:/docker-entrypoint-initdb.d
    ports:
      - 5432:5432
```

#### Содержимое `init-scripts/init.sql`
```sql
-- Создание роли и базы данных
CREATE ROLE phonebook_user WITH LOGIN PASSWORD 'secure_password';
CREATE DATABASE phonebook_db OWNER phonebook_user;

-- Настройка прав доступа
\c phonebook_db  -- Подключаемся к созданной базе данных
GRANT CONNECT ON DATABASE phonebook_db TO phonebook_user;
GRANT USAGE ON SCHEMA public TO phonebook_user;
GRANT ALL ON ALL TABLES IN SCHEMA public TO phonebook_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO phonebook_user;
```

---

### Важно учитывать:
1. **Автозапуск SQL-скриптов**: Все файлы в папке `/docker-entrypoint-initdb.d` исполняются при первом запуске контейнера, если база данных ещё не была инициализирована.
2. **Подключение к базе данных внутри скрипта**: Команда `\c` (или её аналоги) используется для переключения базы данных в SQL-скриптах.
3. **Права и безопасность**: Использование роли с минимальными правами для приложения повышает безопасность вашей системы. Не используйте суперпользовательскую роль для приложения.

### Проверка
После запуска контейнера вы можете подключиться к созданной базе данных через роль `phonebook_user`:

```bash
psql -U phonebook_user -d phonebook_db -h localhost -W
```

Это обеспечит, что роль и база данных работают так, как ожидается.