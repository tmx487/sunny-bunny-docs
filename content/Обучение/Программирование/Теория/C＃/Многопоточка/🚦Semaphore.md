**Semaphore (—Å–µ–º–∞—Ñ–æ—Ä)** ‚Äî —ç—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–∏–º–∏—Ç–∏–≤, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –µ–º–∫–æ—Å—Ç—å—é, –ø–æ–∑–≤–æ–ª—è—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ—Ç–æ–∫–æ–≤.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Semaphore

1. **–°—á–µ—Ç—á–∏–∫ –¥–æ—Å—Ç—É–ø–∞** ‚Äî —Å–µ–º–∞—Ñ–æ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å—á–µ—Ç—á–∏–∫, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    
2. **–î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
    
    - `Semaphore` ‚Äî –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (kernel object)
    - [[‚öúÔ∏èSemaphoreSlim|SemaphoreSlim]] ‚Äî –æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è)
    
3. **–û–ø–µ—Ä–∞—Ü–∏–∏**:
    
    - `WaitOne()` / `Wait()` ‚Äî —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫, –µ—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
    - `Release()` ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫, –ø–æ–∑–≤–æ–ª—è—è –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–∞–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø

## –î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω Semaphore

### 1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º —Å –ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –µ–º–∫–æ—Å—Ç—å—é

–ù–∞–ø—Ä–∏–º–µ—Ä, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```csharp
// –†–∞–∑—Ä–µ—à–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
private static SemaphoreSlim _dbConnectionPool = new SemaphoreSlim(5, 5);

public async Task ExecuteDatabaseOperation()
{
    await _dbConnectionPool.WaitAsync();
    try
    {
        // –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        await using var connection = new SqlConnection(_connectionString);
        await connection.OpenAsync();
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π...
    }
    finally
    {
        // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å–µ–º–∞—Ñ–æ—Ä
        _dbConnectionPool.Release();
    }
}
```

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏

–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:

```csharp
// –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ –±–æ–ª–µ–µ 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
private static SemaphoreSlim _throttler = new SemaphoreSlim(3, 3);

public async Task ProcessLargeFiles(List<string> filePaths)
{
    var tasks = filePaths.Select(async filePath =>
    {
        await _throttler.WaitAsync();
        try
        {
            await ProcessLargeFileAsync(filePath);
        }
        finally
        {
            _throttler.Release();
        }
    });
    
    await Task.WhenAll(tasks);
}
```

### 3. –ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é:

```csharp
// –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–≤—É–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å
using (var semaphore = new Semaphore(2, 2, "Global\\SharedResourceAccess"))
{
    if (semaphore.WaitOne(TimeSpan.FromSeconds(10)))
    {
        try
        {
            // –î–æ—Å—Ç—É–ø –∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º—É —Ä–µ—Å—É—Ä—Å—É
            ProcessSharedResource();
        }
        finally
        {
            semaphore.Release();
        }
    }
    else
    {
        Console.WriteLine("–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞");
    }
}
```

üîÑ –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ü–∏–∫–ª–µ –∏–ª–∏ —á–µ—Ä–µ–∑ `Parallel.For`, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –º–∞–∫—Å–∏–º—É–º 2 –ø–æ—Ç–æ–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

---
## –û—Ç–ª–∏—á–∏–µ –æ—Ç [[üîí Mutex|Mutex]] –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

| –ú–µ—Ö–∞–Ω–∏–∑–º                                     | –û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ                    | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                |
| -------------------------------------------- | -------------------------------------- | ------------------------------------------ |
| **Semaphore**                                | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤         | –î–æ–ø—É—Å–∫–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–æ–≤ |
| **[[üîí Mutex\|Mutex]]**                      | –í–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ                    | –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –≤–ª–∞–¥–µ—Ç—å —Ä–µ—Å—É—Ä—Å–æ–º   |
| **[[üîêlock\|lock]]/[[üñ•Ô∏èMonitor\|Monitor]]** | –ë—ã—Å—Ç—Ä–∞—è –≤–Ω—É—Ç—Ä–∏–ø—Ä–æ—Ü–µ—Å—Å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø             |
| **ReaderWriterLock**                         | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏               | –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —á–∏—Ç–∞—Ç–µ–ª–µ–π –∏–ª–∏ –æ–¥–∏–Ω –ø–∏—Å–∞—Ç–µ–ª—å      |

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–í—ã–±–æ—Ä —Ç–∏–ø–∞ —Å–µ–º–∞—Ñ–æ—Ä–∞**:
    
    - –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [[‚öúÔ∏èSemaphoreSlim|SemaphoreSlim]] (–±—ã—Å—Ç—Ä–µ–µ)
    - –î–ª—è –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Semaphore`
    
2. **–í—Å–µ–≥–¥–∞ –æ—Å–≤–æ–±–æ–∂–¥–∞–π—Ç–µ —Å–µ–º–∞—Ñ–æ—Ä** –≤ –±–ª–æ–∫–µ `finally` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è deadlock
    
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –º–µ—Ç–æ–¥–æ–≤** (`WaitAsync`) –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ
    
4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞–º–∏** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ `Wait` —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏, —á—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è
    
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
    

–°–µ–º–∞—Ñ–æ—Ä—ã –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö, –≥–¥–µ –Ω—É–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ä–∞–∑–¥–µ–ª—è–µ–º—ã–º —Ä–µ—Å—É—Ä—Å–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ API –∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–∏–º –æ–ø–µ—Ä–∞—Ü–∏—è–º.