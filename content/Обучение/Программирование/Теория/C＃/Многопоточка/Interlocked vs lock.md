## üîÅ `Interlocked` vs `lock`

|–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞|`Interlocked`|`lock` (—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä –¥–ª—è `Monitor.Enter/Exit`)|
|---|---|---|
|**–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–π**|–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã–µ (–∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞, –∑–∞–º–µ–Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–π)|–õ—é–±—ã–µ –±–ª–æ–∫–∏ –∫–æ–¥–∞|
|**–û–±—ä—ë–º –∑–∞—â–∏—â–∞–µ–º–æ–≥–æ –∫–æ–¥–∞**|–¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è|–ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫/–æ–ø–µ—Ä–∞—Ü–∏–π|
|**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**|–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è|–ù–∏–∂–µ, —á–µ–º —É `Interlocked`|
|**–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (wait)**|–ë–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫|–ü–æ—Ç–æ–∫–∏ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è|
|**–ì–∏–±–∫–æ—Å—Ç—å**|–ù–∏–∑–∫–∞—è (—Ç–æ–ª—å–∫–æ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è)|–í—ã—Å–æ–∫–∞—è (–º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –ª—é–±—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏)|
|**–†–∏—Å–∫ –¥–µ–¥–ª–æ–∫–∞**|–ù–µ—Ç|–ï—Å—Ç—å, –µ—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å|
|**–†–∞–±–æ—Ç–∞–µ—Ç —Å...**|`int`, `long`, `object`, `IntPtr`, –∏ –¥—Ä.|–° –ª—é–±—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö|

---

## ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Interlocked`

–ò—Å–ø–æ–ª—å–∑—É–π `Interlocked`, –µ—Å–ª–∏:

- –ù—É–∂–Ω–æ **–≤—Å–µ–≥–æ –ª–∏—à—å —É–≤–µ–ª–∏—á–∏—Ç—å, —É–º–µ–Ω—å—à–∏—Ç—å, –æ–±–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ**.
    
- –¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å —Å **–æ–¥–Ω–∏–º —á–∏—Å–ª–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º** –∏–ª–∏ —Å—Å—ã–ª–∫–æ–π.
    
- –¢—ã —Ö–æ—á–µ—à—å **–º–∞–∫—Å–∏–º—É–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**.
    
- –ü—Ä–∏–º–µ—Ä:
    
    ```csharp
    Interlocked.Increment(ref counter);
    Interlocked.Exchange(ref someRef, newValue);
    ```
    

---

## ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `lock`

–ò—Å–ø–æ–ª—å–∑—É–π `lock`, –µ—Å–ª–∏:

- –ù—É–∂–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π** (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å).
    
- –ù—É–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å **—Å—Å—ã–ª–æ—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏, —Å–ø–∏—Å–∫–∞–º–∏, –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ —Ç.–ø.**.
    
- –ù—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤, —á–∏—Ç–∞—é—â–∏—Ö/–ø–∏—à—É—â–∏—Ö –≤ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç**.
    
- –ü—Ä–∏–º–µ—Ä:
    
    ```csharp
    private static object syncObj = new object();
    
    lock (syncObj)
    {
        if (!items.Contains(x))
            items.Add(x);
    }
    ```
    

---

## üìå –ü—Ä–∏–º–µ—Ä, –≥–¥–µ `lock` –Ω—É–∂–µ–Ω, –∞ `Interlocked` –Ω–µ –ø–æ–º–æ–∂–µ—Ç:

```csharp
List<int> numbers = new List<int>();
object locker = new object();

void AddIfNotExists(int n)
{
    lock (locker)
    {
        if (!numbers.Contains(n))
        {
            numbers.Add(n);
        }
    }
}
```

–ï—Å–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Interlocked`, –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–π–¥–µ—Ç ‚Äî –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## üß† –í—ã–≤–æ–¥:

|–ï—Å–ª–∏ –Ω—É–∂–Ω–æ‚Ä¶|–ò—Å–ø–æ–ª—å–∑—É–π‚Ä¶|
|---|---|
|–ü—Ä–æ—Å—Ç–æ —É–≤–µ–ª–∏—á–∏—Ç—å/—É–º–µ–Ω—å—à–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ|`Interlocked`|
|–ó–∞—â–∏—Ç–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫ –∫–æ–¥–∞|`lock`|
