```cs
 using var scope = _logger.BeginScope(new Dictionary<string, object>
        {
            ["CorrelationId"] = correlationId,
            ["BotToken"] = MaskToken(botToken),
            ["UpdateId"] = update.UpdateId
        });
```


`BeginScope` —Å–æ–∑–¥–∞–µ—Ç **–∫–æ–Ω—Ç–µ–∫—Å—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º –≤ –ª–æ–≥–∞—Ö –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ scope'–∞.

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ BeginScope:

### üéØ **1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**

```csharp
// –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –≤ –∫–∞–∂–¥–æ–º –ª–æ–≥–µ:
_logger.LogInfo("Message", updateId, botToken, correlationId);

// –ü–∏—à–µ–º –æ–¥–∏–Ω —Ä–∞–∑ –≤ scope:
using var scope = _logger.BeginScope(new { UpdateId = updateId });
_logger.LogInfo("Message"); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç UpdateId!
```

### üîç **2. –õ–µ–≥–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤**

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ webhook'–∞:
grep "CorrelationId: abc-123-def" app.log

# –ù–∞–π—Ç–∏ –≤—Å–µ –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–æ—Ç–∞:
grep "BotToken: 123***789" app.log

# –ù–∞–π—Ç–∏ –≤—Å–µ –æ—à–∏–±–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
grep "UserId: 987654321" app.log | grep ERROR
```

### üìä **3. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

```json
// –í JSON —Ñ–æ—Ä–º–∞—Ç–µ –∫–∞–∂–¥—ã–π –ª–æ–≥ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
{
  "timestamp": "2024-01-15T10:30:01Z",
  "level": "Information", 
  "message": "Webhook –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ",
  "properties": {
    "CorrelationId": "abc-123-def",
    "BotToken": "123***789",
    "UpdateId": 123456,
    "UserId": 987654321,
    "ChatId": 987654321
  }
}
```

### üöÄ **4. Troubleshooting –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

**Scenario 1: –û—à–∏–±–∫–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**

```
[ERROR] –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook
CorrelationId: abc-123-def, BotToken: 123***789, UpdateId: 123456

# –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –í–°–ï –ª–æ–≥–∏ —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:
grep "CorrelationId: abc-123-def" logs/
```

**Scenario 2: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**

```csharp
using var scope = _logger.BeginScope(new { 
    CorrelationId = correlationId,
    StartTime = DateTime.UtcNow 
});

// –í –∫–æ–Ω—Ü–µ:
_logger.LogInformation("Processed in {ElapsedMs}ms", stopwatch.ElapsedMilliseconds);
```

### üîÑ **5. –í–ª–æ–∂–µ–Ω–Ω—ã–µ scope'—ã**

```csharp
// –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
using var mainScope = _logger.BeginScope(new { CorrelationId = "abc-123" });

// –°–µ—Ä–≤–∏—Å –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
using var serviceScope = _logger.BeginScope(new { ServiceName = "MessageProcessor" });

// –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –ò CorrelationId –ò ServiceName!
```

## –ù–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏ –º–æ–≥—É—Ç —Å–ø—Ä–æ—Å–∏—Ç—å:

**"–ó–∞—á–µ–º –Ω—É–∂–µ–Ω CorrelationId?"**

- –°–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ –ª–æ–≥–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏

**"–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –µ—Å–ª–∏ –∑–∞–±—ã—Ç—å using?"**

- Scope –Ω–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ú–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ memory leak
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç "–ø—Ä–æ—Ç–µ–∫–∞—Ç—å" –≤ –¥—Ä—É–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã

65
- Structured logging —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
- Middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ç–∏–ø–∞ Serilog.Context

BeginScope –¥–µ–ª–∞–µ—Ç –ª–æ–≥–∏ **—á–∏—Ç–∞–µ–º—ã–º–∏**, **—Ñ–∏–ª—å—Ç—Ä—É–µ–º—ã–º–∏** –∏ **–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–º–∏** - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è production —Å–∏—Å—Ç–µ–º!