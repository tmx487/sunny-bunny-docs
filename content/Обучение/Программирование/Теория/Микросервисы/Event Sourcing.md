Event Sourcing (Источники Событий) — это архитектурный паттерн, при котором **состояние системы не сохраняется напрямую, а восстанавливается путем воспроизведения последовательности событий**. Вместо того чтобы хранить "текущее" состояние объекта, вы храните все изменения, которые когда-либо происходили с этим объектом, в виде неизменяемых событий.

**Основные принципы и концепции Event Sourcing:**

1. **События как источник истины:** Каждое изменение в системе фиксируется как "событие". Событие — это факт, который произошел в прошлом (например, "ЗаказСоздан", "ТоварДобавленВКорзину", "ДеньгиСнятыСоСчета"). Эти события являются неизменяемыми и сохраняются в строгом хронологическом порядке.
    
2. **Неизменяемый журнал событий (Event Log/Event Store):** Все события хранятся в специальном хранилище событий, которое работает по принципу "только добавление" (append-only). Это означает, что события записываются одно за другим и никогда не удаляются и не изменяются.
    
3. **Восстановление состояния:** Текущее состояние любой сущности (например, пользователя, заказа, банковского счета) не хранится отдельно. Оно **восстанавливается путем "проигрывания" (replaying)** всех событий, относящихся к этой сущности, начиная с самого первого.
    
4. **Проекции (Projections/Read Models):** Поскольку восстановление состояния из всех событий может быть ресурсоемким для частых запросов на чтение, Event Sourcing часто используется вместе с **CQRS (Command Query Responsibility Segregation)**. В этом случае создаются "проекции" (или "модели чтения") — оптимизированные для чтения представления данных, которые генерируются из потока событий и обновляются по мере поступления новых событий. Эти проекции представляют собой текущее состояние, используемое для запросов, а журнал событий остается источником истины.
    

**Преимущества Event Sourcing:**

- **Полная история и аудит:** Вы всегда имеете полную и неизменяемую историю всех изменений, произошедших в системе. Это бесценно для аудита, отладки, соблюдения нормативных требований и анализа данных.
    
- **Темпоральные запросы:** Можно легко ответить на вопросы, как выглядела система в любой момент времени в прошлом, просто "перемотав" события до нужной точки.
    
- **Восстановление после сбоев:** В случае сбоя системы, вы можете полностью восстановить ее состояние, переиграв все события.
    
- **Отсутствие конфликтов при конкурентных обновлениях:** Поскольку события добавляются, а не изменяют текущее состояние, уменьшается вероятность конфликтов при одновременных изменениях.
    
- **Развитие функциональности:** Позволяет добавлять новые "проекции" и аналитические возможности в будущем, не меняя существующую логику. Можно перепроигрывать старые события для создания новых видов агрегированных данных.
    
- **Декомпозиция и масштабирование:** Хорошо сочетается с микросервисной архитектурой и событийно-ориентированными системами, способствуя слабой связанности компонентов.
    

**Недостатки Event Sourcing:**

- **Сложность реализации:** Паттерн может быть сложнее в реализации и освоении, чем традиционные подходы с хранением текущего состояния.
    
- **Производительность при восстановлении:** Восстановление состояния из большого количества событий может быть медленным. Эта проблема решается с помощью моментальных снимков (snapshots) и проекций.
    
- **Изменение схемы событий:** Изменение структуры старых событий может быть сложной задачей, так как события неизменяемы. Требуются механизмы миграции и версионирования.
    
- **Объем хранения:** Журнал событий может занимать много места, так как хранятся все изменения.
    

**Когда использовать Event Sourcing:**

- Системы, требующие полного аудита и отслеживания изменений.
    
- Системы с комплексными переходами состояний и бизнес-правилами.
    
- Системы, которым необходимо воспроизводить прошлые события для восстановления или анализа.
    
- Системы, где важна историческая ценность данных (например, финансовые системы, IoT).
    
- Когда вы хотите реализовать CQRS.
    

В целом, Event Sourcing — это мощный паттерн, который предоставляет значительные преимущества в определенных сценариях, особенно когда важна история изменений и гибкость в представлении данных.