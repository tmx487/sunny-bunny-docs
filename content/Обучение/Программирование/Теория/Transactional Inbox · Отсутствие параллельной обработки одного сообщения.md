
> üëâ –ö–æ–≥–¥–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫–∏–º-—Ç–æ –≤–æ—Ä–∫–µ—Ä–æ–º, **–¥—Ä—É–≥–∏–µ –≤–æ—Ä–∫–µ—Ä—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∞—Ç—å –µ–≥–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å **–¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏–ª–∏ –≥–æ–Ω–æ–∫ (race conditions)**.

---

## üîç –ó–∞—á–µ–º —ç—Ç–æ –≤–∞–∂–Ω–æ:

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω:

- –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö,
    
- –∏–ª–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Kubernetes),
    
- –∏–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `inbox` —Ç–∞–±–ª–∏—Ü—É **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** (–¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏).
    

üìõ –ë–µ–∑ –∑–∞—â–∏—Ç—ã: **–æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—á–∏—Ç–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** ‚Üí —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ **–¥–≤–æ–π–Ω–æ–π (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π) –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è**.

---

## üõ† –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

### ‚úÖ –†–µ—à–µ–Ω–∏–µ: **–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏** –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏

–í SQL –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```sql
SELECT * FROM inbox
WHERE status = 'pending'
ORDER BY created_at
LIMIT 10
FOR UPDATE SKIP LOCKED;
```

- `FOR UPDATE` ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
    
- `SKIP LOCKED` ‚Äî –¥—Ä—É–≥–∏–µ –≤–æ—Ä–∫–µ—Ä—ã –ø—Ä–æ–ø—É—Å—Ç—è—Ç —É–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (—Ç–æ –µ—Å—Ç—å –Ω–µ —É–≤–∏–¥—è—Ç –∏—Ö).
    

üìå –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: **–æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä "–∑–∞—Ö–≤–∞—Ç–∏–ª" —Å–æ–±—ã—Ç–∏–µ**, –∏ –¥—Ä—É–≥–∏–µ –µ–≥–æ **–Ω–µ —É–≤–∏–¥—è—Ç**, –ø–æ–∫–∞ –æ–Ω –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É.

---

## ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–µ—Å–ª–∏ –Ω–µ—Ç `SKIP LOCKED`):

- –ü—Ä–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ñ–ª–∞–≥ `is_processing = true`, –∏ –¥–µ–ª–∞—Ç—å —ç—Ç–æ **–∞—Ç–æ–º–∞—Ä–Ω–æ** —á–µ—Ä–µ–∑ `UPDATE ... WHERE is_processing = false`.
    
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis-locks / —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –º—å—é—Ç–µ–∫—Å—ã.
    
- –†–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å (in-memory –∏–ª–∏ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π) —Å —è–≤–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º.
    

---

## üéØ –ß—Ç–æ –¥–∞—ë—Ç —ç—Ç–∞ –≥–∞—Ä–∞–Ω—Ç–∏—è:

- –û–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ ‚Üí –æ–¥–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞.
    
- –£—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è **—Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–æ–Ω–∫–∏**.
    
- –ù–µ—Ç **–ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –¥–≤–∞ —Å—á—ë—Ç–∞, –Ω–∞—á–∏—Å–ª–∏–ª–∏ –±–æ–Ω—É—Å –¥–≤–∞–∂–¥—ã –∏ —Ç.–¥.).
    

---

## üîÅ –ü—Ä–∏–º–µ—Ä –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:

–£ —Ç–µ–±—è –¥–≤–∞ –∏–Ω—Å—Ç–∞–Ω—Å–∞ InboxWorker, –∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –µ—Å—Ç—å –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ `send_invoice(456)`.

–ë–µ–∑ –∑–∞—â–∏—Ç—ã:

- –æ–±–∞ –∏–Ω—Å—Ç–∞–Ω—Å–∞ —á–∏—Ç–∞—é—Ç —Å—Ç—Ä–æ–∫—É,
    
- –æ–±–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É,
    
- –¥–≤–∞ —Å—á—ë—Ç–∞ ‚Äî ‚ùå –æ—à–∏–±–∫–∞.
    

–° –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π:

- –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É,
    
- –≤—Ç–æ—Ä–æ–π –µ—ë **–Ω–µ –≤–∏–¥–∏—Ç** –∏ –±–µ—Ä—ë—Ç –¥—Ä—É–≥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî ‚úÖ –≤—Å—ë —Ö–æ—Ä–æ—à–æ.
    

---

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä –Ω–∞ C# + EF Core + PostgreSQL —Å `SKIP LOCKED` –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.